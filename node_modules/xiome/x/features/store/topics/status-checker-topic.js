import { asTopic } from "renraku/x/identities/as-topic.js";
import { StoreStatus } from "./types/store-status.js";
import { determineStoreStatus } from "./utils/determine-store-status.js";
export const statusCheckerTopic = ({ config }) => asTopic()({
    async getStoreStatus({ tables, access, getStripeAccount }) {
        let storeStatus = StoreStatus.Uninitialized;
        if (access.appId !== config.platform.appDetails.appId) {
            const row = await tables.merchant.stripeAccounts.one({
                conditions: false,
            });
            if (row) {
                const account = await getStripeAccount(row.stripeAccountId);
                storeStatus = await determineStoreStatus({ account, tables });
            }
        }
        return storeStatus;
    },
});
//# sourceMappingURL=status-checker-topic.js.map