!function(){"use strict";const e="undefined"!=typeof window&&null!=window.customElements&&void 0!==window.customElements.polyfillWrapFlushCallback,t=(e,t,i=null)=>{for(;t!==i;){const i=t.nextSibling;e.removeChild(t),t=i}},i=`{{lit-${String(Math.random()).slice(2)}}}`,o=`\x3c!--${i}--\x3e`,n=new RegExp(`${i}|${o}`),s="$lit$";class r{constructor(e,t){this.parts=[],this.element=t;const o=[],r=[],l=document.createTreeWalker(t.content,133,null,!1);let p=0,u=-1,h=0;const{strings:m,values:{length:f}}=e;for(;h<f;){const e=l.nextNode();if(null!==e){if(u++,1===e.nodeType){if(e.hasAttributes()){const t=e.attributes,{length:i}=t;let o=0;for(let e=0;e<i;e++)a(t[e].name,s)&&o++;for(;o-- >0;){const t=m[h],i=d.exec(t)[2],o=i.toLowerCase()+s,r=e.getAttribute(o);e.removeAttribute(o);const a=r.split(n);this.parts.push({type:"attribute",index:u,name:i,strings:a}),h+=a.length-1}}"TEMPLATE"===e.tagName&&(r.push(e),l.currentNode=e.content)}else if(3===e.nodeType){const t=e.data;if(t.indexOf(i)>=0){const i=e.parentNode,r=t.split(n),l=r.length-1;for(let t=0;t<l;t++){let o,n=r[t];if(""===n)o=c();else{const e=d.exec(n);null!==e&&a(e[2],s)&&(n=n.slice(0,e.index)+e[1]+e[2].slice(0,-s.length)+e[3]),o=document.createTextNode(n)}i.insertBefore(o,e),this.parts.push({type:"node",index:++u})}""===r[l]?(i.insertBefore(c(),e),o.push(e)):e.data=r[l],h+=l}}else if(8===e.nodeType)if(e.data===i){const t=e.parentNode;null!==e.previousSibling&&u!==p||(u++,t.insertBefore(c(),e)),p=u,this.parts.push({type:"node",index:u}),null===e.nextSibling?e.data="":(o.push(e),u--),h++}else{let t=-1;for(;-1!==(t=e.data.indexOf(i,t+1));)this.parts.push({type:"node",index:-1}),h++}}else l.currentNode=r.pop()}for(const e of o)e.parentNode.removeChild(e)}}const a=(e,t)=>{const i=e.length-t.length;return i>=0&&e.slice(i)===t},l=e=>-1!==e.index,c=()=>document.createComment(""),d=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;function p(e,t){const{element:{content:i},parts:o}=e,n=document.createTreeWalker(i,133,null,!1);let s=h(o),r=o[s],a=-1,l=0;const c=[];let d=null;for(;n.nextNode();){a++;const e=n.currentNode;for(e.previousSibling===d&&(d=null),t.has(e)&&(c.push(e),null===d&&(d=e)),null!==d&&l++;void 0!==r&&r.index===a;)r.index=null!==d?-1:r.index-l,s=h(o,s),r=o[s]}c.forEach((e=>e.parentNode.removeChild(e)))}const u=e=>{let t=11===e.nodeType?0:1;const i=document.createTreeWalker(e,133,null,!1);for(;i.nextNode();)t++;return t},h=(e,t=-1)=>{for(let i=t+1;i<e.length;i++){const t=e[i];if(l(t))return i}return-1};const m=new WeakMap,f=e=>"function"==typeof e&&m.has(e),g={},v={};class b{constructor(e,t,i){this.__parts=[],this.template=e,this.processor=t,this.options=i}update(e){let t=0;for(const i of this.__parts)void 0!==i&&i.setValue(e[t]),t++;for(const e of this.__parts)void 0!==e&&e.commit()}_clone(){const t=e?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),i=[],o=this.template.parts,n=document.createTreeWalker(t,133,null,!1);let s,r=0,a=0,c=n.nextNode();for(;r<o.length;)if(s=o[r],l(s)){for(;a<s.index;)a++,"TEMPLATE"===c.nodeName&&(i.push(c),n.currentNode=c.content),null===(c=n.nextNode())&&(n.currentNode=i.pop(),c=n.nextNode());if("node"===s.type){const e=this.processor.handleTextExpression(this.options);e.insertAfterNode(c.previousSibling),this.__parts.push(e)}else this.__parts.push(...this.processor.handleAttributeExpressions(c,s.name,s.strings,this.options));r++}else this.__parts.push(void 0),r++;return e&&(document.adoptNode(t),customElements.upgrade(t)),t}}const y=window.trustedTypes&&trustedTypes.createPolicy("lit-html",{createHTML:e=>e}),w=` ${i} `;class x{constructor(e,t,i,o){this.strings=e,this.values=t,this.type=i,this.processor=o}getHTML(){const e=this.strings.length-1;let t="",n=!1;for(let r=0;r<e;r++){const e=this.strings[r],a=e.lastIndexOf("\x3c!--");n=(a>-1||n)&&-1===e.indexOf("--\x3e",a+1);const l=d.exec(e);t+=null===l?e+(n?w:o):e.substr(0,l.index)+l[1]+l[2]+s+l[3]+i}return t+=this.strings[e],t}getTemplateElement(){const e=document.createElement("template");let t=this.getHTML();return void 0!==y&&(t=y.createHTML(t)),e.innerHTML=t,e}}class k extends x{getHTML(){return`<svg>${super.getHTML()}</svg>`}getTemplateElement(){const e=super.getTemplateElement(),t=e.content,i=t.firstChild;return t.removeChild(i),((e,t,i=null,o=null)=>{for(;t!==i;){const i=t.nextSibling;e.insertBefore(t,o),t=i}})(t,i.firstChild),e}}const S=e=>null===e||!("object"==typeof e||"function"==typeof e),I=e=>Array.isArray(e)||!(!e||!e[Symbol.iterator]);class ${constructor(e,t,i){this.dirty=!0,this.element=e,this.name=t,this.strings=i,this.parts=[];for(let e=0;e<i.length-1;e++)this.parts[e]=this._createPart()}_createPart(){return new P(this)}_getValue(){const e=this.strings,t=e.length-1,i=this.parts;if(1===t&&""===e[0]&&""===e[1]){const e=i[0].value;if("symbol"==typeof e)return String(e);if("string"==typeof e||!I(e))return e}let o="";for(let n=0;n<t;n++){o+=e[n];const t=i[n];if(void 0!==t){const e=t.value;if(S(e)||!I(e))o+="string"==typeof e?e:String(e);else for(const t of e)o+="string"==typeof t?t:String(t)}}return o+=e[t],o}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}}class P{constructor(e){this.value=void 0,this.committer=e}setValue(e){e===g||S(e)&&e===this.value||(this.value=e,f(e)||(this.committer.dirty=!0))}commit(){for(;f(this.value);){const e=this.value;this.value=g,e(this)}this.value!==g&&this.committer.commit()}}class A{constructor(e){this.value=void 0,this.__pendingValue=void 0,this.options=e}appendInto(e){this.startNode=e.appendChild(c()),this.endNode=e.appendChild(c())}insertAfterNode(e){this.startNode=e,this.endNode=e.nextSibling}appendIntoPart(e){e.__insert(this.startNode=c()),e.__insert(this.endNode=c())}insertAfterPart(e){e.__insert(this.startNode=c()),this.endNode=e.endNode,e.endNode=this.startNode}setValue(e){this.__pendingValue=e}commit(){if(null===this.startNode.parentNode)return;for(;f(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=g,e(this)}const e=this.__pendingValue;e!==g&&(S(e)?e!==this.value&&this.__commitText(e):e instanceof x?this.__commitTemplateResult(e):e instanceof Node?this.__commitNode(e):I(e)?this.__commitIterable(e):e===v?(this.value=v,this.clear()):this.__commitText(e))}__insert(e){this.endNode.parentNode.insertBefore(e,this.endNode)}__commitNode(e){this.value!==e&&(this.clear(),this.__insert(e),this.value=e)}__commitText(e){const t=this.startNode.nextSibling,i="string"==typeof(e=null==e?"":e)?e:String(e);t===this.endNode.previousSibling&&3===t.nodeType?t.data=i:this.__commitNode(document.createTextNode(i)),this.value=e}__commitTemplateResult(e){const t=this.options.templateFactory(e);if(this.value instanceof b&&this.value.template===t)this.value.update(e.values);else{const i=new b(t,e.processor,this.options),o=i._clone();i.update(e.values),this.__commitNode(o),this.value=i}}__commitIterable(e){Array.isArray(this.value)||(this.value=[],this.clear());const t=this.value;let i,o=0;for(const n of e)i=t[o],void 0===i&&(i=new A(this.options),t.push(i),0===o?i.appendIntoPart(this):i.insertAfterPart(t[o-1])),i.setValue(n),i.commit(),o++;o<t.length&&(t.length=o,this.clear(i&&i.endNode))}clear(e=this.startNode){t(this.startNode.parentNode,e.nextSibling,this.endNode)}}class R{constructor(e,t,i){if(this.value=void 0,this.__pendingValue=void 0,2!==i.length||""!==i[0]||""!==i[1])throw new Error("Boolean attributes can only contain a single expression");this.element=e,this.name=t,this.strings=i}setValue(e){this.__pendingValue=e}commit(){for(;f(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=g,e(this)}if(this.__pendingValue===g)return;const e=!!this.__pendingValue;this.value!==e&&(e?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=e),this.__pendingValue=g}}class _ extends ${constructor(e,t,i){super(e,t,i),this.single=2===i.length&&""===i[0]&&""===i[1]}_createPart(){return new q(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}}class q extends P{}let C=!1;(()=>{try{const e={get capture(){return C=!0,!1}};window.addEventListener("test",e,e),window.removeEventListener("test",e,e)}catch(e){}})();class M{constructor(e,t,i){this.value=void 0,this.__pendingValue=void 0,this.element=e,this.eventName=t,this.eventContext=i,this.__boundHandleEvent=e=>this.handleEvent(e)}setValue(e){this.__pendingValue=e}commit(){for(;f(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=g,e(this)}if(this.__pendingValue===g)return;const e=this.__pendingValue,t=this.value,i=null==e||null!=t&&(e.capture!==t.capture||e.once!==t.once||e.passive!==t.passive),o=null!=e&&(null==t||i);i&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),o&&(this.__options=O(e),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=e,this.__pendingValue=g}handleEvent(e){"function"==typeof this.value?this.value.call(this.eventContext||this.element,e):this.value.handleEvent(e)}}const O=e=>e&&(C?{capture:e.capture,passive:e.passive,once:e.once}:e.capture);function T(e){let t=E.get(e.type);void 0===t&&(t={stringsArray:new WeakMap,keyString:new Map},E.set(e.type,t));let o=t.stringsArray.get(e.strings);if(void 0!==o)return o;const n=e.strings.join(i);return o=t.keyString.get(n),void 0===o&&(o=new r(e,e.getTemplateElement()),t.keyString.set(n,o)),t.stringsArray.set(e.strings,o),o}const E=new Map,L=new WeakMap,N=(e,i,o)=>{let n=L.get(i);void 0===n&&(t(i,i.firstChild),L.set(i,n=new A(Object.assign({templateFactory:T},o))),n.appendInto(i)),n.setValue(e),n.commit()};const j=new class{handleAttributeExpressions(e,t,i,o){const n=t[0];if("."===n){return new _(e,t.slice(1),i).parts}if("@"===n)return[new M(e,t.slice(1),o.eventContext)];if("?"===n)return[new R(e,t.slice(1),i)];return new $(e,t,i).parts}handleTextExpression(e){return new A(e)}};"undefined"!=typeof window&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.4.1");const D=(e,...t)=>new x(e,t,"html",j),U=(e,...t)=>new k(e,t,"svg",j),z=(e,t)=>`${e}--${t}`;let B=!0;void 0===window.ShadyCSS?B=!1:void 0===window.ShadyCSS.prepareTemplateDom&&(console.warn("Incompatible ShadyCSS version detected. Please update to at least @webcomponents/webcomponentsjs@2.0.2 and @webcomponents/shadycss@1.3.1."),B=!1);const H=e=>t=>{const o=z(t.type,e);let n=E.get(o);void 0===n&&(n={stringsArray:new WeakMap,keyString:new Map},E.set(o,n));let s=n.stringsArray.get(t.strings);if(void 0!==s)return s;const a=t.strings.join(i);if(s=n.keyString.get(a),void 0===s){const i=t.getTemplateElement();B&&window.ShadyCSS.prepareTemplateDom(i,e),s=new r(t,i),n.keyString.set(a,s)}return n.stringsArray.set(t.strings,s),s},F=["html","svg"],V=new Set,W=(e,t,i)=>{V.add(e);const o=i?i.element:document.createElement("template"),n=t.querySelectorAll("style"),{length:s}=n;if(0===s)return void window.ShadyCSS.prepareTemplateStyles(o,e);const r=document.createElement("style");for(let e=0;e<s;e++){const t=n[e];t.parentNode.removeChild(t),r.textContent+=t.textContent}(e=>{F.forEach((t=>{const i=E.get(z(t,e));void 0!==i&&i.keyString.forEach((e=>{const{element:{content:t}}=e,i=new Set;Array.from(t.querySelectorAll("style")).forEach((e=>{i.add(e)})),p(e,i)}))}))})(e);const a=o.content;i?function(e,t,i=null){const{element:{content:o},parts:n}=e;if(null==i)return void o.appendChild(t);const s=document.createTreeWalker(o,133,null,!1);let r=h(n),a=0,l=-1;for(;s.nextNode();)for(l++,s.currentNode===i&&(a=u(t),i.parentNode.insertBefore(t,i));-1!==r&&n[r].index===l;){if(a>0){for(;-1!==r;)n[r].index+=a,r=h(n,r);return}r=h(n,r)}}(i,r,a.firstChild):a.insertBefore(r,a.firstChild),window.ShadyCSS.prepareTemplateStyles(o,e);const l=a.querySelector("style");if(window.ShadyCSS.nativeShadow&&null!==l)t.insertBefore(l.cloneNode(!0),t.firstChild);else if(i){a.insertBefore(r,a.firstChild);const e=new Set;e.add(r),p(i,e)}};window.JSCompiler_renameProperty=(e,t)=>e;const Q={toAttribute(e,t){switch(t){case Boolean:return e?"":null;case Object:case Array:return null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){switch(t){case Boolean:return null!==e;case Number:return null===e?null:Number(e);case Object:case Array:return JSON.parse(e)}return e}},G=(e,t)=>t!==e&&(t==t||e==e),X={attribute:!0,type:String,converter:Q,reflect:!1,hasChanged:G},J="finalized";class Z extends HTMLElement{constructor(){super(),this.initialize()}static get observedAttributes(){this.finalize();const e=[];return this._classProperties.forEach(((t,i)=>{const o=this._attributeNameForProperty(i,t);void 0!==o&&(this._attributeToPropertyMap.set(o,i),e.push(o))})),e}static _ensureClassProperties(){if(!this.hasOwnProperty(JSCompiler_renameProperty("_classProperties",this))){this._classProperties=new Map;const e=Object.getPrototypeOf(this)._classProperties;void 0!==e&&e.forEach(((e,t)=>this._classProperties.set(t,e)))}}static createProperty(e,t=X){if(this._ensureClassProperties(),this._classProperties.set(e,t),t.noAccessor||this.prototype.hasOwnProperty(e))return;const i="symbol"==typeof e?Symbol():`__${e}`,o=this.getPropertyDescriptor(e,i,t);void 0!==o&&Object.defineProperty(this.prototype,e,o)}static getPropertyDescriptor(e,t,i){return{get(){return this[t]},set(o){const n=this[e];this[t]=o,this.requestUpdateInternal(e,n,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this._classProperties&&this._classProperties.get(e)||X}static finalize(){const e=Object.getPrototypeOf(this);if(e.hasOwnProperty(J)||e.finalize(),this.finalized=!0,this._ensureClassProperties(),this._attributeToPropertyMap=new Map,this.hasOwnProperty(JSCompiler_renameProperty("properties",this))){const e=this.properties,t=[...Object.getOwnPropertyNames(e),..."function"==typeof Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e):[]];for(const i of t)this.createProperty(i,e[i])}}static _attributeNameForProperty(e,t){const i=t.attribute;return!1===i?void 0:"string"==typeof i?i:"string"==typeof e?e.toLowerCase():void 0}static _valueHasChanged(e,t,i=G){return i(e,t)}static _propertyValueFromAttribute(e,t){const i=t.type,o=t.converter||Q,n="function"==typeof o?o:o.fromAttribute;return n?n(e,i):e}static _propertyValueToAttribute(e,t){if(void 0===t.reflect)return;const i=t.type,o=t.converter;return(o&&o.toAttribute||Q.toAttribute)(e,i)}initialize(){this._updateState=0,this._updatePromise=new Promise((e=>this._enableUpdatingResolver=e)),this._changedProperties=new Map,this._saveInstanceProperties(),this.requestUpdateInternal()}_saveInstanceProperties(){this.constructor._classProperties.forEach(((e,t)=>{if(this.hasOwnProperty(t)){const e=this[t];delete this[t],this._instanceProperties||(this._instanceProperties=new Map),this._instanceProperties.set(t,e)}}))}_applyInstanceProperties(){this._instanceProperties.forEach(((e,t)=>this[t]=e)),this._instanceProperties=void 0}connectedCallback(){this.enableUpdating()}enableUpdating(){void 0!==this._enableUpdatingResolver&&(this._enableUpdatingResolver(),this._enableUpdatingResolver=void 0)}disconnectedCallback(){}attributeChangedCallback(e,t,i){t!==i&&this._attributeToProperty(e,i)}_propertyToAttribute(e,t,i=X){const o=this.constructor,n=o._attributeNameForProperty(e,i);if(void 0!==n){const e=o._propertyValueToAttribute(t,i);if(void 0===e)return;this._updateState=8|this._updateState,null==e?this.removeAttribute(n):this.setAttribute(n,e),this._updateState=-9&this._updateState}}_attributeToProperty(e,t){if(8&this._updateState)return;const i=this.constructor,o=i._attributeToPropertyMap.get(e);if(void 0!==o){const e=i.getPropertyOptions(o);this._updateState=16|this._updateState,this[o]=i._propertyValueFromAttribute(t,e),this._updateState=-17&this._updateState}}requestUpdateInternal(e,t,i){let o=!0;if(void 0!==e){const n=this.constructor;i=i||n.getPropertyOptions(e),n._valueHasChanged(this[e],t,i.hasChanged)?(this._changedProperties.has(e)||this._changedProperties.set(e,t),!0!==i.reflect||16&this._updateState||(void 0===this._reflectingProperties&&(this._reflectingProperties=new Map),this._reflectingProperties.set(e,i))):o=!1}!this._hasRequestedUpdate&&o&&(this._updatePromise=this._enqueueUpdate())}requestUpdate(e,t){return this.requestUpdateInternal(e,t),this.updateComplete}async _enqueueUpdate(){this._updateState=4|this._updateState;try{await this._updatePromise}catch(e){}const e=this.performUpdate();return null!=e&&await e,!this._hasRequestedUpdate}get _hasRequestedUpdate(){return 4&this._updateState}get hasUpdated(){return 1&this._updateState}performUpdate(){if(!this._hasRequestedUpdate)return;this._instanceProperties&&this._applyInstanceProperties();let e=!1;const t=this._changedProperties;try{e=this.shouldUpdate(t),e?this.update(t):this._markUpdated()}catch(t){throw e=!1,this._markUpdated(),t}e&&(1&this._updateState||(this._updateState=1|this._updateState,this.firstUpdated(t)),this.updated(t))}_markUpdated(){this._changedProperties=new Map,this._updateState=-5&this._updateState}get updateComplete(){return this._getUpdateComplete()}_getUpdateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._updatePromise}shouldUpdate(e){return!0}update(e){void 0!==this._reflectingProperties&&this._reflectingProperties.size>0&&(this._reflectingProperties.forEach(((e,t)=>this._propertyToAttribute(t,this[t],e))),this._reflectingProperties=void 0),this._markUpdated()}updated(e){}firstUpdated(e){}}Z.finalized=!0;const Y=(e,t)=>"method"===t.kind&&t.descriptor&&!("value"in t.descriptor)?Object.assign(Object.assign({},t),{finisher(i){i.createProperty(t.key,e)}}):{kind:"field",key:Symbol(),placement:"own",descriptor:{},initializer(){"function"==typeof t.initializer&&(this[t.key]=t.initializer.call(this))},finisher(i){i.createProperty(t.key,e)}};function K(e){return(t,i)=>void 0!==i?((e,t,i)=>{t.constructor.createProperty(i,e)})(e,t,i):Y(e,t)}function ee(e,t){return(i,o)=>{const n={get(){return this.renderRoot.querySelector(e)},enumerable:!0,configurable:!0};if(t){const t=void 0!==o?o:i.key,s="symbol"==typeof t?Symbol():`__${t}`;n.get=function(){return void 0===this[s]&&(this[s]=this.renderRoot.querySelector(e)),this[s]}}return void 0!==o?te(n,i,o):ie(n,i)}}const te=(e,t,i)=>{Object.defineProperty(t,i,e)},ie=(e,t)=>({kind:"method",placement:"prototype",key:t.key,descriptor:e}),oe=window.ShadowRoot&&(void 0===window.ShadyCSS||window.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,ne=Symbol();class se{constructor(e,t){if(t!==ne)throw new Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e}get styleSheet(){return void 0===this._styleSheet&&(oe?(this._styleSheet=new CSSStyleSheet,this._styleSheet.replaceSync(this.cssText)):this._styleSheet=null),this._styleSheet}toString(){return this.cssText}}const re=(e,...t)=>{const i=t.reduce(((t,i,o)=>t+(e=>{if(e instanceof se)return e.cssText;if("number"==typeof e)return e;throw new Error(`Value passed to 'css' function must be a 'css' function result: ${e}. Use 'unsafeCSS' to pass non-literal values, but\n            take care to ensure page security.`)})(i)+e[o+1]),e[0]);return new se(i,ne)};(window.litElementVersions||(window.litElementVersions=[])).push("2.5.1");const ae={};class le extends Z{static getStyles(){return this.styles}static _getUniqueStyles(){if(this.hasOwnProperty(JSCompiler_renameProperty("_styles",this)))return;const e=this.getStyles();if(Array.isArray(e)){const t=(e,i)=>e.reduceRight(((e,i)=>Array.isArray(i)?t(i,e):(e.add(i),e)),i),i=t(e,new Set),o=[];i.forEach((e=>o.unshift(e))),this._styles=o}else this._styles=void 0===e?[]:[e];this._styles=this._styles.map((e=>{if(e instanceof CSSStyleSheet&&!oe){const t=Array.prototype.slice.call(e.cssRules).reduce(((e,t)=>e+t.cssText),"");return new se(String(t),ne)}return e}))}initialize(){super.initialize(),this.constructor._getUniqueStyles(),this.renderRoot=this.createRenderRoot(),window.ShadowRoot&&this.renderRoot instanceof window.ShadowRoot&&this.adoptStyles()}createRenderRoot(){return this.attachShadow(this.constructor.shadowRootOptions)}adoptStyles(){const e=this.constructor._styles;0!==e.length&&(void 0===window.ShadyCSS||window.ShadyCSS.nativeShadow?oe?this.renderRoot.adoptedStyleSheets=e.map((e=>e instanceof CSSStyleSheet?e:e.styleSheet)):this._needsShimAdoptedStyleSheets=!0:window.ShadyCSS.ScopingShim.prepareAdoptedCssText(e.map((e=>e.cssText)),this.localName))}connectedCallback(){super.connectedCallback(),this.hasUpdated&&void 0!==window.ShadyCSS&&window.ShadyCSS.styleElement(this)}update(e){const t=this.render();super.update(e),t!==ae&&this.constructor.render(t,this.renderRoot,{scopeName:this.localName,eventContext:this}),this._needsShimAdoptedStyleSheets&&(this._needsShimAdoptedStyleSheets=!1,this.constructor._styles.forEach((e=>{const t=document.createElement("style");t.textContent=e.cssText,this.renderRoot.appendChild(t)})))}render(){return ae}}le.finalized=!0,le.render=(e,i,o)=>{if(!o||"object"!=typeof o||!o.scopeName)throw new Error("The `scopeName` option is required.");const n=o.scopeName,s=L.has(i),r=B&&11===i.nodeType&&!!i.host,a=r&&!V.has(n),l=a?document.createDocumentFragment():i;if(N(e,l,Object.assign({templateFactory:H(n)},o)),a){const e=L.get(l);L.delete(l);const o=e.value instanceof b?e.value.template:void 0;W(n,l,o),t(i,i.firstChild),i.appendChild(l),L.set(i,e)}!s&&r&&window.ShadyCSS.styleElement(i.host)},le.shadowRootOptions={mode:"open"};class ce extends le{}const de=Symbol("shadowRoot"),pe=Symbol("_handleButtonClick");class ue extends ce{static get styles(){return re`
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			*:focus {
				outline: var(--focus-outline, 2px solid #0af);
			}

			:host([theme="concrete"]) button {
				position: relative;
				display: block;
				margin: var(--menu-gapsize, 0.15rem);
				padding: 0;
				border: none;
				background: transparent;
			}

			.panel {
				display: none;
			}

			:host([open]) .panel {
				display: block;
			}

			:host([theme="concrete"]) .panel {
				position: absolute;
				left: var(--menu-lanesize, 1rem);
				right: var(--menu-lanesize, 1rem);
				width: var(--menu-panel-width, 640px);
				max-width: calc(100% - calc(var(--menu-lanesize, 1rem) * 2));
				margin-top: var(--menu-gapsize, 0.15rem);
				margin-left: auto;
				padding: var(--menu-panel-padding, 1rem);
				background: var(--menu-panel-background, white);
				border-radius: var(--menu-panel-border-radius, 0);
				box-shadow: var(--menu-panel-box-shadow, none);
				backdrop-filter: var(--menu-panel-backdrop-filter, none);
				--webkit-backdrop-filter: var(--menu-panel-backdrop-filter, none);
			}

			:host([theme="concrete"][sticky]) .panel {
				top: 100%;
			}

			:host([theme="concrete"][lefty]) .panel {
				margin-left: unset;
				margin-right: auto;
			}
		`}static get properties(){return{toggle:{type:Function},open:{type:Boolean,reflect:!0},theme:{type:String,reflect:!0},lefty:{type:Boolean,reflect:!0},sticky:{type:Boolean,reflect:!0}}}constructor(){super(),this.theme="",this.open=!1,this.toggle=()=>{},this[pe]=()=>this.toggle()}createRenderRoot(){return this[de]=this.attachShadow({mode:"closed"}),this[de]}updated(e){e.has("open")&&this.open&&this[de].querySelector("button").focus()}render(){return D`
			<div class="display">
				<button @click="${this[pe]}">
					<slot name="button"></slot>
				</button>
				<div class="panel">
					<slot></slot>
				</div>
			</div>
		`}}const he=["scroll","resize"];const me=Symbol("scrollTop"),fe=Symbol("shadowRoot"),ge=Symbol("activeIndex"),ve=Symbol("toggleIndex"),be=Symbol("scrollMarmot"),ye=Symbol("getMenuDisplays"),we=Symbol("updateScrollPoint"),xe=Symbol("handleBlanketClick"),ke=(function(e=navigator.userAgent){const t=/(?:^|\s)Edge\/([\d\.]+)(?:\s|$)/i.exec(e);return!!t&&t[1]}()||"").startsWith("17.");!function(e){for(const t of Object.keys(e))customElements.define(t.replace(/([a-zA-Z])(?=[A-Z])/g,"$1-").toLowerCase(),e[t])}({MenuSystem:class extends ce{static get properties(){return{"initially-hidden":{type:Boolean,reflect:!0},theme:{type:String,reflect:!0},lefty:{type:Boolean,reflect:!0},active:{type:Boolean,reflect:!0},sticky:{type:Boolean,reflect:!0},[me]:{type:Number},[ge]:{type:String}}}constructor(){super(),this.theme="concrete",this.active=!1,this.sticky=!1,this.lefty=!1,ke&&this.setAttribute("data-edge-17","data-edge-17"),this[ge]=void 0,this[me]=0,this[be]=void 0,this[we]=e=>{this.active||(this[me]=e)},this[xe]=()=>{this[ve](this[ge])},this[ve]=e=>{this[ge]=e===this[ge]?void 0:e,this.active=void 0!==this[ge]},this[ye]=()=>function(e){return Array.from(e.assignedNodes()).filter((e=>e instanceof HTMLElement))}(this[fe].querySelector("slot")).filter((e=>e instanceof ue))}createRenderRoot(){return this[fe]=this.attachShadow({mode:"closed"}),this[fe].addEventListener("slotchange",(()=>this.requestUpdate())),this[fe]}_initScrollMarmot(){this.sticky&&!this[be]&&(this[be]=function({onScrollUpdate:e}){function t(){const t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;e(t)}for(const e of he)window.addEventListener(e,t);return t(),{dispose(){for(const e of he)window.removeEventListener(e,t,{passive:!0})}}}({onScrollUpdate:this[we]}))}_disposeScrollMarmot(){this[be]&&(this[be].dispose(),this[be]=null)}connectedCallback(){super.connectedCallback(),this.isConnected&&this._initScrollMarmot()}disconnectedCallback(){super.disconnectedCallback(),this._disposeScrollMarmot()}updated(){this._initScrollMarmot(),this.sticky||this._disposeScrollMarmot(),this[ye]().forEach(((e,t)=>{e.theme=this.theme,e.lefty=this.lefty,e.toggle=()=>this[ve](t),e.open=t===this[ge]}))}firstUpdated(){this["initially-hidden"]=!1}static get styles(){return re`
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			*:focus {
				outline: var(--focus-outline, 2px solid cyan);
			}

			.system {
				position: static;
				margin: var(--menu-margin, auto);
			}

			:host([theme="concrete"]) .system {
				display: flex;
				align-items: flex-end;
				justify-content: flex-end;
			}

			:host([theme="concrete"][sticky]) .system {
				pointer-events: none;
				position: absolute;
				width: 100%;
				right: 0;
			}

			:host([theme="concrete"][sticky]) .system > * {
				pointer-events: all;
			}

			:host([theme="concrete"][lefty]) .system {
				right: auto;
				left: 0;
				align-items: flex-start;
				justify-content: flex-start;
			}

			:host([theme="concrete"]) .blanket {
				z-index: 99;
				display: none;
				position: fixed;
				background: var(--menu-blanket-background, rgba(0,0,0, 0.5));
				backdrop-filter: var(--menu-blanket-backdrop-filter, blur(5px));
				--webkit-backdrop-filter: var(--menu-blanket-backdrop-filter, blur(5px));
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
			}

			:host([theme="concrete"][active]) .blanket {
				display: block;
			}

			:host([theme="concrete"]) .list {
				z-index: 100;
				display: flex;
				align-items: flex-end;
				justify-content: flex-end;
				padding: var(--menu-gapsize, 0.15rem);
				background: var(--menu-background, rgba(240, 240, 240, 0.5));
			}

			:host([theme="concrete"][sticky]) .list {
				margin-right: var(--menu-lanesize, 1rem);
			}

			:host([theme="concrete"][sticky][lefty]) .list {
				margin-right: unset;
				margin-left: var(--menu-lanesize, 1rem);
			}

			:host([theme="concrete"]) .list slot::slotted(menu-display) {
				display: block;
				flex: 0 0 auto;
			}

			/* gross edge 17 stuff we all want to forget about */

			:host([data-edge-17][theme="concrete"]) .system {
				z-index: 100;
				position: absolute;
				width: 100%;
				right: 0;
			}

			:host([data-edge-17][theme="concrete"]) .blanket {
				z-index: 0;
			}
		`}render(){const e=this.sticky?this[me]:0;return D`
			<div class="system" style="${`top: ${e}px`}">
				<div class="blanket" @click="${this[xe]}"></div>
				<div class="list">
					<slot></slot>
				</div>
			</div>
		`}},MenuDisplay:ue}),window.process={env:{NODE_ENV:"development"}};const Se=e=>new Promise((t=>setTimeout(t,e)));function Ie(e,t){return(...i)=>t(e,...i)}async function $e({connection:e,frontend:t}){const{loginService:i}=e.remote.auth;i.sendLoginLink=Ie(i.sendLoginLink,(async(i,...o)=>{await i(...o);const n=e.backend.emails.recallLatestLoginEmail();console.log("mock: logging in..."),await Se(1e3),await t.models.authModel.login(n.loginToken),console.log(`mock: logged in as ${n.to}`)})),e.popups.triggerBankPopup=Ie(e.popups.triggerBankPopup,(async(...e)=>{console.log("mock: bank popup",e)}))}const Pe="https://api.xiome.io";function Ae({mockStripeOperations:e}){return{triggerBankPopup:async({stripeAccountId:t})=>{await e.linkBankWithExistingStripeAccount(t)}}}const Re=6e4,_e=864e5,qe=({platformHome:e,platformOrigins:t})=>({server:{port:4999,detailedLogs:!0},platform:{legalLink:"https://xiome.io/legal",technician:{email:"chasemoskal@gmail.com"},appDetails:{appId:"6Ns7WcB8xCqgSSMtqxZNCYXDK8N8qNM2cFRrwGggrTSD8TDx",label:"Xiome Cloud",home:e,origins:t}},email:"mock-console",database:"mock-localstorage",stripe:"mock-mode",crypto:{keys:"mock-mode",tokenLifespans:{login:3e5,refresh:30*_e,access:3e5,external:3e5}}});function Ce(e,t){const i={};for(const[o,n]of Object.entries(e))i[o]=t(n,o);return i}function Me(e){return null!=e&&"object"==typeof e}const Oe=Symbol();function Te({link:e,shape:t,specpath:i=[],requester:o}){return Ce(t,((t,n)=>{if(Me(s=t)&&s[Oe]){const{getMeta:s}=t[Oe];function r(t,a=[]){return Ce(t,((t,l)=>!0===t?async(...t)=>{const r=[...i,...a,n,l].join("."),c=await s();return await o({link:e,args:t,meta:c,specifier:r})}:Me(t)?r(t,[...a,l]):void 0))}return r(t)}if(Me(t))return Te({link:e,shape:t,specpath:[...i,n],requester:o});var s}))}function Ee({link:e,meta:t,args:i,specifier:o,requestOrigin:n,headers:s}){return{method:"post",path:new URL(e).pathname,headers:{"content-type":"text/plain; charset=utf-8",...n?{origin:n}:{},...s},body:JSON.stringify({jsonrpc:"2.0",method:o,params:[t,...i]})}}function Le(e){const t=JSON.parse(e.body);if(200!==e.status||t.error){const i=t.error?.message;throw new Error(i?`${e.status}: ${i}`:"unknown error")}return t.result}function Ne({link:e,shape:t,headers:i,servelet:o}){return Te({link:e,shape:t,requester:async({args:e,link:t,meta:n,specifier:s})=>{const r=Ee({link:t,args:e,meta:n,headers:i,specifier:s});return Le(await o(r))}})}class je extends Error{code;constructor(e,t){super(t),this.code=e}}function De(){const e=Date.now();return function(){return Date.now()-e}}function Ue(e){function t(e){return(...t)=>e(function(e){const t=new Date(e);return`[${t.getUTCFullYear().toString().padStart(4,"0")}-${(t.getUTCMonth()+1).toString().padStart(2,"0")}-${t.getUTCDate().toString().padStart(2,"0")}::${t.getUTCHours().toString().padStart(2,"0")}:${t.getUTCMinutes().toString().padStart(2,"0")}:${t.getUTCSeconds().toString().padStart(2,"0")}.${t.getUTCMilliseconds().toString().padStart(3,"0")}]`}(Date.now()),...t)}return{log:t(e.log),warn:t(e.warn),error:t(e.error)}}function ze(e,t=!1){return function(e,t){return{logRequest({specifier:i,meta:o,args:n,times:s,result:r}){t?e.log(`🛎️ ${i}()`,"\n 👥",o,"\n 📜",n,`\n ⏱️ ${s.total}ms (${s.auth}ms + ${s.procedure}ms)\n 🎁`,r):e.log(`🛎️ ${i}() ${s.total}ms (${s.auth}ms + ${s.procedure}ms)`)},logApiError(t){e.warn(`⚠️ ${t.code} ApiError: ${t.message}`)},logUnexpectedError(t){e.error("🚨 unexpected error!\n",t)}}}(Ue(t?function(e){function t(e){return(...t)=>{if(t.length>0&&"string"==typeof t[0]){const[i,...o]=t;e("\n"+i,...o)}else e("\n",...t)}}return{log:t(e.log),warn:t(e.warn),error:t(e.error)}}(e):e),t)}function Be({expose:e,responder:t,serveletLogger:i=ze(console),parseRequest:o}){return async function(n){let s;try{const r=De(),{requestId:a,specifier:l,meta:c,args:d}=await o(n);s=a;const{func:p,policy:u}=function(e,t){return e.split(".").reduce(((e,t)=>e&&e[t]||void 0),t)}(l,e),h={auth:-1,procedure:-1,total:-1},m=De(),f=await u.processAuth(c,n);h.auth=m();const g=De(),v=await p(f,...d);h.procedure=g();const b=t.resultResponse(a,v);return h.total=r(),i.logRequest({specifier:l,meta:c,args:d,times:h,result:v}),b}catch(e){return function(e){return!!e&&e instanceof je}(e)?(i.logApiError(e),t.errorResponse(s,e)):(i.logUnexpectedError(e),t.errorResponse(s,new je(500,"error")))}}}async function He(e){const{id:t,method:i,params:o}=JSON.parse(e.body),n=i,[s,...r]=o;return{requestId:t,specifier:n,meta:s,args:r}}const Fe="application/json; charset=utf-8",Ve=({headers:e})=>({resultResponse:(t,i)=>({status:200,headers:{"Content-Type":Fe,...e},body:JSON.stringify({jsonrpc:"2.0",id:t,result:i})}),errorResponse:(t,i)=>({status:i.code,headers:{"Content-Type":Fe,...e},body:JSON.stringify({jsonrpc:"2.0",id:t,error:{code:-32e3,message:i.message}})})});function We(){let e=[];return{publish:async(...t)=>{const i=e.map((e=>e(...t)));await Promise.all(i)},subscribe:t=>(e.push(t),()=>{e=e.filter((e=>e!==t))}),dispose:()=>{e=[]}}}const Qe="function"==typeof atob;const Ge=Object.freeze({encode:e=>function(e){return e+Array((4-e.length%4)%4+1).join("=")}(function(e){return Qe?btoa(e):Buffer.from(e).toString("base64")}(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")),decode:e=>function(e){return Qe?atob(e):Buffer.from(e,"base64").toString("binary")}(e.replace(/-/g,"+").replace(/_/g,"/"))});const Xe=function(e){const[,t]=e.split("."),i=decodeURIComponent(Ge.decode(t).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join(""));return JSON.parse(i)};function Je(e){return!!e&&!function(e){const t=1e3*e;return Date.now()>t-6e4}(Xe(e).exp)}const Ze=e=>Xe(e).payload;function Ye({appId:e,storage:t}){let i;const o={getMeta:async()=>({accessToken:await i.getAccessToken()})};return{shape:{auth:{greenService:{[Oe]:{getMeta:async()=>{}},authorize:!0},loginService:{[Oe]:o,authenticateViaLoginToken:!0,sendLoginLink:!0},appService:{[Oe]:o,listApps:!0,registerApp:!0},appEditService:{[Oe]:o,deleteApp:!0,updateApp:!0},manageAdminsService:{[Oe]:o,listAdmins:!0,assignAdmin:!0,revokeAdmin:!0,assignPlatformUserAsAdmin:!0},personalService:{[Oe]:o,setProfile:!0},userService:{[Oe]:o,getUser:!0},permissionsService:{[Oe]:o,assignPrivilege:!0,createRole:!0,deleteRole:!0,fetchPermissions:!0,unassignPrivilege:!0}},administrative:{roleAssignmentService:{[Oe]:o,fetchPermissions:!0,searchUsers:!0,assignRoleToUser:!0,revokeRoleFromUser:!0}},questions:{questionsReadingService:{[Oe]:o,fetchQuestions:!0},questionsPostingService:{[Oe]:o,postQuestion:!0,archiveQuestion:!0,likeQuestion:!0,reportQuestion:!0},questionsModerationService:{[Oe]:o,archiveBoard:!0}}},installAuthMediator:function({greenService:o}){return i=function({appId:e,storage:t,greenService:i}){const o=We(),n=We(),s=`auth-tokens-${e}`,r=async()=>await t.read(s)??{accessToken:void 0,refreshToken:void 0},a=async e=>t.write(s,e);async function l(e){const t=Ze(e.accessToken);return await a(e),o.publish(),await n.publish(t),t}async function c(t){const o=await i.authorize({appId:e,refreshToken:t,scope:{core:!0}});return{access:await l({accessToken:o,refreshToken:t}),accessToken:o}}const d=async()=>{const{accessToken:e,refreshToken:t}=await r();return Je(e)?{accessToken:e,access:Ze(e)}:Je(t)?c(t):c(void 0)};return{subscribeToAccessChange:n.subscribe,subscribeToTokenChange:o.subscribe,async initialize(){const{access:e}=await d();return await n.publish(e),e},getAccess:async()=>(await d()).access,getAccessToken:async()=>(await d()).accessToken,login:async e=>l(e),logout:async()=>(await a({accessToken:void 0,refreshToken:void 0}),(await d()).access),async reauthorize(){const e=await r();return await a({...e,accessToken:void 0}),(await d()).access}}}({appId:e,storage:t,greenService:o}),i}}}function Ke(e,t){const i={};for(const[o,n]of Object.entries(e))i[o]=t(n,o);return i}function et(e,t){const i={};for(const[o,n]of Object.entries(e))i[o]=t(n,o);return i}function tt({latency:e,remote:t}){return function t(i){return Ke(i,((i,o)=>{if("function"==typeof i)return async(...t)=>{const o=function(){if(!1===e)return 0;const t=e.max-e.min,i=Math.random()*t;return e.min+i}();return await Se(o),i(...t)};if("object"==typeof(i??void 0))return t(i);throw new Error("unknown remote type")}))}(t)}function it({api:e,appId:t,origin:i,apiLink:o,latency:n,storage:s}){const{shape:r,installAuthMediator:a}=Ye({appId:t,storage:s}),l=function({logger:e,fullyDebug:t,remote:i}){let o=1;return function i(n,s=[]){return Ke(n,((n,r)=>{const a=[...s,r];if("function"==typeof n)return async(...i)=>{const s=o++,r=`#${s} ${a.join(".")}`;t?e.log(r,...i):e.log(r);const l=await n(...i);return t&&e.log(`    #${s} return:`,l),l};if("object"==typeof(n??void 0))return i(n,a);throw new Error("unknown remote type")}))}(i)}({logger:console,fullyDebug:!1,remote:tt({latency:n,remote:Ne({shape:r,link:o,headers:{origin:i},servelet:(c=e,d={logRequest(){},logApiError(){},logUnexpectedError(){}},Be({expose:c,serveletLogger:d,responder:Ve({headers:{}}),parseRequest:He}))})})});var c,d;return{remote:l,authMediator:a({greenService:l.auth.greenService})}}function ot(e){const t=new BroadcastChannel("tokenChangeEvent");e.subscribeToTokenChange((()=>t.postMessage(void 0))),t.onmessage=()=>e.initialize()}async function nt({apiLink:e,appId:t,storage:i,latency:o,appWindowLink:n,backend:s}){const{remote:r,authMediator:a}=it({appId:t,apiLink:e,storage:i,latency:o,api:s.api,origin:new URL(n).origin});return ot(a),{remote:r,authMediator:a}}const st=e=>Ge.encode(JSON.stringify(e));function rt(...e){return["and",...e]}function at(...e){return["or",...e]}function lt(...e){return e.length?{conditions:at(...e.map((e=>({equal:e}))))}:{conditions:!1}}async function ct(e,t){const i=`dbby-${t}`;let o=[];async function n(){o=await e.read(i)||[]}async function s(){e&&await e.write(i,o)}function r(e){return o.filter((t=>pt(t,e)))}function a(e){return o.find((t=>pt(t,e)))}function l(e,t){for(const i of e)for(const[e,o]of Object.entries(t))i[e]=o}function c(e){o.push(dt(e))}function d(e){o=o.filter((t=>!pt(t,e)))}return await n(),{async create(...e){await n();for(const t of e)c(t);await s()},async read({order:e,offset:t=0,limit:i=1e3,...o}){await n();const s=dt(r(o));if(e)for(const[t,i]of Object.entries(e))s.sort(((e,o)=>"ascend"===i?e[t]>o[t]?1:-1:e[t]>o[t]?-1:1));return s.slice(t,t+i)},one:async e=>(await n(),dt(a(e))),async assert({make:e,...t}){await n();let i=dt(a(t));if(!i){const t=await e();c(t),i=dt(t),await s()}return i},async update({write:e,whole:t,upsert:i,...o}){await n();const a=r(o);if(e&&a.length)l(a,e);else if(i)a.length?l(a,i):c(i);else{if(!t)throw new Error("invalid update");d(o),c(t)}await s()},async delete(e){await n(),d(e),await s()},count:async e=>(await n(),r(e).length)}}function dt(e){if(void 0!==e)return JSON.parse(JSON.stringify(e))}function pt(e,t){return function t(i){if(!1===i)return!0;const[o,...n]=i,s=n.filter((e=>!!e));if(0===s.length)throw new Error("empty and/or conditions are not allowed");const r="and"===o;let a=r;const l=e=>a=r?a&&e:a||e;for(const i of s)if(!1===i||Array.isArray(i))l(t(i));else{l(ut(e,i))}return a}(t.conditions)}function ut(e,t){if(!Object.keys(t).length)return!0;let i=0;const o=(t,o)=>{t&&!function(e,t,i){let o=0;for(const[n,s]of Object.entries(t))i(e[n],s)||(o+=1);return!o}(e,t,o)&&(i+=1)},n=e=>null!=e,s=(e,t)=>e===t,r=(e,t)=>e>t,a=(e,t)=>e>=t,l=(e,t)=>e<t,c=(e,t)=>e<=t,d=(e,t)=>e.includes(t),p=(e,t)=>"string"==typeof t?e.includes(t):t.test(e);function u(e){return(t,i)=>!e(t,i)}return o(t.set,n),o(t.equal,s),o(t.greater,r),o(t.greatery,a),o(t.less,l),o(t.lessy,c),o(t.listed,d),o(t.search,p),o(t.notSet,u(n)),o(t.notEqual,u(s)),o(t.notGreater,u(r)),o(t.notGreatery,u(a)),o(t.notLess,u(l)),o(t.notLessy,u(c)),o(t.notListed,u(d)),o(t.notSearch,u(p)),!i}function ht(e){return!("object"!=typeof e||null===e||Array.isArray(e)||e instanceof Promise)}function mt(e,t=[]){let i=[];for(const[o,n]of Object.entries(e))ht(n)?i=[...i,...mt(n,[...t,o])]:i.push([[...t,o],n]);return i}function ft(e){return mt(e)}function gt(e,t,i){let o=e;for(let e=0;e<t.length;e++){const n=e===t.length-1,s=t[e],r=o[s];if(n)o[s]=i;else{if(ht(r))o=r;else{const e={};o[s]=e,o=e}}}}async function vt(e){const t=ft(e);return function(e){const t={};for(const[i,o]of e)gt(t,i,o);return t}(await async function(e){const t=[],i=[];for(const[o,n]of e)t.push(o),i.push(n);const o=await Promise.all(i);return t.map(((e,t)=>[e,o[t]]))}(t))}const bt="undefined"!=typeof process&&"node"===process?.release?.name;const yt="256789BCDFGHJKMNPRSTWXYZbcdfghkmnpqrstwxyz";function wt(e){const t=function(e){let t="";for(const i of new Uint8Array(e))t+=("0"+(255&i).toString(16)).slice(-2);return t}(e);return BigInt("0x"+t)}function xt(e){let t=function(e){const t=e=>e<42n?yt[Number(e)]:t(e/42n)+yt[Number(e%42n)],i=wt(e);return t(i)}(e);for(;t.length<48;)t=yt[0]+t;return t}const kt=Symbol(),St=Symbol();function It(){return function e({expose:t,policy:i}){return Ce(t,((t,o)=>{if(function(e){return"function"==typeof e}(t))return{[St]:!0,policy:i,func:t};if(Me(t))return{[kt]:!0,...e({policy:i,expose:t})};throw new Error(`unknown api context subtype for "${o}"`)}))}}function $t(e,t){return t.platform.appDetails.appId===e}async function Pt(e){const t=Object.keys(e),i=Object.values(e),o=await Promise.all(i),n={};return t.forEach(((e,t)=>n[e]=o[t])),n}function At(...e){return t=>{const i=[];for(const o of e)for(const e of o(t))i.push(e);return i}}function Rt(e){const t=Object.keys(e);return i=>Object.entries(i).flatMap((([i,o])=>t.includes(i)?e[i](o).map((e=>`"${i}": ${e}`)):[`"${i} not in schema"`]))}function _t(...e){return t=>{const i=e.map((e=>e(t)));let o=!1;for(const e of i)0===e.length&&(o=!0);return o?[]:i.flat().map(((e,t)=>t>0?`or, ${e}`:e))}}function qt(...e){return t=>{let i=[];for(const o of e)if(i=o(t),i.length>0)break;return i}}function Ct(...e){return t=>{if(!Array.isArray(t))return["must be array"];const i=At(...e),o=[];return t.forEach(((e,t)=>{for(const n of i(e))o.push(`(${t+1}) ${n}`)})),o}}const Mt=e=>t=>t.length<e?["too small"]:[],Ot=e=>t=>t.length>e?["too big"]:[],Tt=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,Et=()=>e=>Tt.test(e)?[]:["invalid email"],Lt=qt((e=>"string"!=typeof e?["must be a string"]:[]),Ot(1e3),(e=>/^https?:\/\/[a-zA-Z\.\d-]+(?:|:\d+)$/i.test(e)?[]:["invalid origin"]),_t((e=>/^https:\/\//i.test(e)?[]:["must be secure, starting with 'https'"]),(e=>/^https?:\/\/(127\.0\.0\.1|localhost)(|:\d{1,5})(|\/\S*)$/i.test(e)?[]:["must be a localhost address"]))),Nt=Object.freeze({home:At(qt((e=>"string"!=typeof e?["must be a string"]:[]),Mt(1),Ot(2e3),_t(qt((e=>{try{return new URL(e),[]}catch(e){return["invalid url"]}}),(e=>/^https:\/\//i.test(e)?[]:["must be secure, starting with 'https'"])),(e=>/^https?:\/\/(127\.0\.0\.1|localhost)(|:\d{1,5})(|\/\S*)$/i.test(e)?[]:["must be a localhost address"])))),label:At(qt((e=>"string"!=typeof e?["must be a string"]:[]),Mt(1),Ot(50),(e=>e.length>0&&0===e.trim().length?["can't be all whitespace"]:[]))),origins:At(qt(Mt(1),Ot(100),Ct(Lt))),additionalOrigins:At(qt((e=>Array.isArray(e)?[]:["must be an array"]),Mt(0),Ot(99),Ct(Lt)))}),jt=Rt({home:Nt.home,label:Nt.label,origins:Nt.origins});function Dt(e){return jt(e)}function Ut(e){return e.join(";")}function zt(e){return e.split(";")}function Bt(e){if(e.length>0)throw new je(400,e.join("; "))}const Ht=({rando:e,config:t})=>({async listApps({tables:e,statsHub:i},{ownerUserId:o}){const n=await e.app.appOwnership.read(lt({userId:o})),s=n.length?await e.app.app.read({conditions:rt(at(...n.map((e=>({equal:{appId:e.appId}})))),{equal:{archived:!1}})}):[];return Promise.all(s.map((async e=>({appId:e.appId,label:e.label,home:e.home,origins:zt(e.origins),platform:$t(e.appId,t),stats:await Pt({users:i.countUsers(e.appId),usersActiveDaily:i.countUsersActiveDaily(e.appId),usersActiveMonthly:i.countUsersActiveMonthly(e.appId)})}))))},async registerApp({tables:t},{appDraft:i,ownerUserId:o}){Bt(Dt(i));const n=e.randomId();return await Promise.all([t.app.app.create({appId:n,label:i.label,home:i.home,origins:Ut(i.origins),archived:!1}),t.app.appOwnership.create({appId:n,userId:o})]),{...i,appId:n,stats:{users:1,usersActiveDaily:0,usersActiveMonthly:0}}}}),Ft=({avatar:e,tagline:t,nickname:i})=>({tagline:t,nickname:i,avatar:JSON.parse(e)});async function Vt({userIds:e,authTables:t,permissionsEngine:i}){if(!e.length)throw new Error("invalid: userIds cannot be empty");const o=at(...e.map((e=>({equal:{userId:e}})))),n=await t.user.account.read({conditions:o}),s=await t.user.profile.read({conditions:o}),r=await i.getPublicRolesForUsers(e);return e.map((function(e){const t=n.find((t=>t.userId===e)),i=s.find((t=>t.userId===e));if(!t)throw new je(404,`account not found for user id ${e}`);if(!i)throw new je(404,`profile not found for user id ${e}`);const o=r.find((t=>t.userId===e)).publicUserRoles,a={joined:t.created};return{userId:e,profile:Ft(i),roles:o,stats:a}}))}async function Wt({userId:e,...t}){return(await Vt({...t,userIds:[e]})).find((e=>e.userId))}function Qt(e,t,i){const o=[...e];for(const e of t){!!o.find((t=>i(t,e)))||o.push(e)}return o}function Gt(e,t){const i={};for(const o of Object.keys(e))i[o]=t;return i}function Xt(e,t){return Gt(t,{active:e,immutable:!0})}const Jt={"read questions":"22M8Tcp2xMg9hN5YxKkbffXpNHScTCnPXSXztzRnPXbC9RsD","post questions":"75KrRyRPRnZZZKrh2zcwB98MCsZX9HCwg66qrzYTSprdqSTf","like questions":"8qpc7M8nGkscwcSSW8d6Z7FyKGsxB8W5PWt2PCzk2sSJGgYb","report questions":"86qRZfryfMWSfRhmkWkpq6pRYWCybmyNsD8RfxS7RpTqXN9J"},Zt={"edit any profile":"2Z5M2n7pg9nRhwztgqztK6rBTPnyfr6fxk6T29sdfRTNGTqp","customize permissions":"5Y5sBg2JtqqWnPXq5xXYRDB2cFygtc9StwN7GSZsBXzDBNNW","moderate questions":"5dHqPzNHGsYnbqkF252ZhWS25hwCGrBSS67RBpmfm7by9dGF","view stats":"2DWWssJp7G88kH9swMPxSZ529mXqn6kFM7zFMS9yn5P5RkGZ","administrate user roles":"6HpSB2ZGcCsDGwHHmHKZCqYgpPxSg5kyw8PYtx5R2m6zBxmt"},Yt={"edit any app":"77nZH9ksyDDBf6ptNZ9MNZzJdfMyWfG5PYbYwmmX6kTGMhkw","view platform stats":"2nth28xGTC6TbPNzCHf72pRchr8FpPyDbwMRTnTsppPk9DC8"},Kt={"manage store":"658Kh8yMybF8hNr55JGkbCYtwyJpFd6MfRhFPcYdGskbtbzG","give away freebies":"8R5fFWCJy8PMDJsPNkn8HqzpMGHBkMMfXz9HCzx7XdnrcKzJ"},ei=!0,ti=!1,ii={privileges:{...Jt,...Zt,banned:"5BrX6GbqgzDnhsTGsX6xxqsxNSNdC2RzFZzntNXdGc7bmmkK"},roles:{anonymous:{roleId:"2tcdnygHqf9YXdtXWnk5hrzTWH5z9ynp6S8SFHXgdd67THDS",public:!0,assignable:!1,hasPrivileges:{...Xt(ti,Jt),...Xt(ti,Zt),banned:{active:!1,immutable:!0},"read questions":{active:!0,immutable:!1}}},authenticated:{roleId:"2NJPCdCByYJ9N2yPmY6TNypCbksyMwDhKtfhNKXRdsRPCMDK",public:!1,assignable:!1,hasPrivileges:{...function(e,t){return Gt(t,{active:e,immutable:!1})}(ei,Jt),...Xt(ti,Zt),banned:{active:!1,immutable:!0}}},banned:{roleId:"8FN9yGdMCBptMMCqHTHSJJ6PHtwpBWmtdPGGDzbTKCqdzsHC",public:!0,assignable:!0,hasPrivileges:{...Xt(ti,Jt),...Xt(ti,Zt),banned:{active:!0,immutable:!0}}},technician:{roleId:"9DTMZY2NJm9HXMS7Tc2MYBf5HqcKWD98yNdZFNPrRhtb6yFq",public:!0,assignable:!1,hasPrivileges:{...Xt(ei,Jt),...Xt(ei,Zt),banned:{active:!1,immutable:!0}}}}},oi={privileges:{...ii.privileges,...Yt},roles:{...ii.roles,anonymous:{...ii.roles.anonymous,hasPrivileges:{...ii.roles.anonymous.hasPrivileges,...Xt(ti,Yt)}},authenticated:{...ii.roles.authenticated,hasPrivileges:{...ii.roles.authenticated.hasPrivileges,...Xt(ti,Yt)}},banned:{...ii.roles.banned,hasPrivileges:{...ii.roles.banned.hasPrivileges,...Xt(ti,Yt)}},technician:{...ii.roles.technician,hasPrivileges:{...ii.roles.technician.hasPrivileges,...Xt(ei,Jt),...Xt(ei,Yt)}}}},ni={privileges:{...ii.privileges,...Kt},roles:{...ii.roles,anonymous:{...ii.roles.anonymous,hasPrivileges:{...ii.roles.anonymous.hasPrivileges,...Xt(ti,Kt)}},authenticated:{...ii.roles.authenticated,hasPrivileges:{...ii.roles.authenticated.hasPrivileges,...Xt(ti,Kt)}},banned:{...ii.roles.banned,hasPrivileges:{...ii.roles.banned.hasPrivileges,...Xt(ti,Kt)}},admin:{roleId:"7KWz2MKkFynJ5FNBG86tChyXwGDkpBZcdJxCxpkmhrmnScqm",public:!0,assignable:!1,hasPrivileges:{...Xt(ei,Kt),...Xt(ei,Jt),...Xt(ei,Zt),banned:{active:!1,immutable:!0}}},technician:{...ii.roles.technician,hasPrivileges:{...ii.roles.technician.hasPrivileges,...Xt(ei,Kt)}}}};function si({timeframeStart:e,timeframeEnd:t}){const i=Date.now();return!(void 0!==e&&i>e)&&!(void 0!==t&&i<t)}function ri({isPlatform:e,permissionsTables:t}){const{hardPermissions:i,mergeRoleHasPrivileges:o,getActivePrivilegeIds:n,getHardPrivilegeDetails:s}=function({isPlatform:e}){const t=e?oi:ni;return{hardPermissions:t,mergeRoleHasPrivileges:function({hard:e,soft:t}){const i=[];function o(e,t){return e.roleId===t.roleId&&e.privilegeId===t.privilegeId}function n(e){return{roleId:e.roleId,privilegeId:e.privilegeId,active:e.active,immutable:e.immutable}}for(const s of t){const t=e.find((e=>o(e,s)));i.push(t&&t.immutable?n(t):s)}for(const t of e)i.find((e=>o(t,e)))||i.push(n(t));return i},getActivePrivilegeIds:function(e){return e.filter((e=>e.active)).map((e=>e.privilegeId))},getHardPrivilegeDetails:function(...e){const i=[];for(const o of e){const e=Object.entries(t.roles).find((([,e])=>e.roleId===o));if(e){const[,n]=e;for(const[e,s]of Object.entries(n.hasPrivileges)){const n=t.privileges[e];i.find((e=>e.roleId===o&&e.privilegeId===n))||i.push({privilegeId:n,roleId:o,active:s.active,immutable:s.immutable})}}}return i}}}({isPlatform:e});async function r({userIds:e,onlyGetPublicRoles:o}){const n=e=>e.public,s=e=>e,r=await(async()=>{if(0===e.length)throw new Error("invalid: user ids cannot be empty");const o=await t.userHasRole.read({conditions:at(...e.map((e=>({equal:{userId:e}}))))}),n=o.map((e=>e.roleId));if(0===e.length)throw new Error("invalid: role ids cannot be empty");const s=[...(await t.role.read({conditions:at(...n.map((e=>({equal:{roleId:e}}))))})).map((e=>e.roleId)),...Object.entries(i.roles).map((([,e])=>e.roleId))];return o.filter((e=>s.includes(e.roleId)))})();return e.map((e=>{const t=r.filter((t=>t.userId===e)).filter(si).filter(o?n:s);return{userId:e,userHasRoles:t}}))}async function a(e){const i=await r({userIds:e,onlyGetPublicRoles:!1}),a=i.flatMap((e=>e.userHasRoles.map((e=>e.roleId)))),l=a.length?await t.roleHasPrivilege.read({conditions:at(...a.map((e=>({equal:{roleId:e}}))))}):[];return e.map((function(e){const t=i.find((t=>t.userId===e)).userHasRoles.map((e=>e.roleId)),r=s(...t),a=t.flatMap((e=>l.filter((t=>t.roleId===e)))),c=n(o({hard:r,soft:a}));return{userId:e,privileges:c}}))}return{getUsersHaveRoles:r,getAnonymousPrivileges:async function(){const e=i.roles.anonymous.roleId,r=s(e),a=await t.roleHasPrivilege.read(lt({roleId:e}));return n(o({hard:r,soft:a}))},getPrivilegesForUsers:a,getPublicRolesForUsers:async function(e){const o=await r({userIds:e,onlyGetPublicRoles:!0}),n=o.flatMap((e=>e.userHasRoles.filter((e=>e.public)).map((e=>e.roleId)))),s=n.map((e=>{const t=Object.entries(i.roles).find((([,t])=>t.roleId===e));if(t){const[i,o]=t;return{roleId:e,label:i,hard:!0,public:o.public,assignable:o.assignable}}})).filter((e=>!!e)),a=n.length?await t.role.read({conditions:at(...n.map((e=>({equal:{roleId:e}}))))}):[],l=[...s];for(const e of a){l.find((t=>t.roleId===e.roleId))||l.push(e)}return e.map((function(e){const t=o.find((t=>t.userId===e)).userHasRoles.map((e=>{const t=l.find((t=>t.roleId===e.roleId));return{...e,...t}})).filter(si).map((e=>({label:e.label,roleId:e.roleId,timeframeEnd:e.timeframeEnd,timeframeStart:e.timeframeStart})));return{userId:e,publicUserRoles:t}}))},getPermissionsDisplay:async function(){const e={conditions:!1};return Pt({roles:(async()=>Qt(await t.role.read(e),Object.entries(i.roles).map((([e,t])=>({label:e,hard:!0,roleId:t.roleId,public:t.public,assignable:t.assignable}))),((e,t)=>e.roleId===t.roleId)))(),privileges:(async()=>Qt(await t.privilege.read(e),Object.entries(i.privileges).map((([e,t])=>({privilegeId:t,label:e,hard:!0}))),((e,t)=>e.privilegeId===t.privilegeId)))(),rolesHavePrivileges:(async()=>{const n=Object.values(i.roles).map((e=>e.roleId)),r=s(...n),a=await t.roleHasPrivilege.read(e);return o({hard:r,soft:a})})()})},getUserPrivileges:async function(e){return(await a([e])).find((t=>t.userId===e)).privileges}}}const ai=({config:e})=>({async getUser({tables:t,access:i},{userId:o}){const n=ri({isPlatform:i.appId===e.platform.appDetails.appId,permissionsTables:t.permissions});return await Wt({userId:o,authTables:t,permissionsEngine:n})}});async function li({userId:e,authTables:t,email:i,generateNickname:o}){const n=JSON.stringify({type:"simple",value:Math.random()});await t.user.profile.create((({userId:e,avatar:t,generateNickname:i})=>({userId:e,avatar:t,tagline:"",nickname:i()}))({userId:e,avatar:n,generateNickname:o}))}const ci={anonymous:ii.roles.anonymous.roleId,authenticated:ii.roles.authenticated.roleId,technician:ii.roles.technician.roleId};async function di({rando:e,email:t,tables:i,config:o,generateNickname:n}){const{userId:s}=await i.user.accountViaEmail.assert({...lt({email:t}),make:async function(){const s=t===o.platform.technician.email,r=function({rando:e}){return{userId:e.randomId(),created:Date.now()}}({rando:e}),{userId:a}=r,l=i.user.account.create(r),c=li({userId:a,email:t,authTables:i,generateNickname:n}),d=i.permissions.userHasRole.create({userId:a,hard:!0,public:!1,roleId:ci.anonymous,timeframeEnd:void 0,timeframeStart:void 0}),p=i.permissions.userHasRole.create({userId:a,hard:!0,public:!1,roleId:ci.authenticated,timeframeEnd:void 0,timeframeStart:void 0}),u=s?i.permissions.userHasRole.create({userId:a,hard:!0,public:!0,timeframeEnd:void 0,roleId:ci.technician,timeframeStart:void 0}):Promise.resolve();return await Promise.all([l,c,d,p,u]),{email:t,userId:a}}});return{userId:s}}const pi=({rando:e,config:t,signToken:i,verifyToken:o,sendLoginEmail:n,generateNickname:s})=>({async sendLoginLink({access:o,tables:r},{email:a}){const l=await r.app.app.one(lt({appId:o.appId})),{userId:c}=await di({rando:e,email:a,config:t,tables:r,generateNickname:s});await n({appHome:l.home,appLabel:l.label,to:a,legalLink:t.platform.legalLink,platformLink:t.platform.appDetails.home,lifespan:t.crypto.tokenLifespans.login,loginToken:await i({payload:{userId:c},lifespan:t.crypto.tokenLifespans.login})})},async authenticateViaLoginToken({tables:e,access:n},{loginToken:r}){const{userId:a}=await o(r),l=await async function({scope:e,appId:t,userId:i,tables:o,origins:n,lifespans:s,permissionsEngine:r,signToken:a,generateNickname:l}){const{user:c,permit:d}=await Pt({user:Wt({userId:i,authTables:o,permissionsEngine:r}),permit:(async()=>({privileges:await r.getUserPrivileges(i)}))()});return Pt({accessToken:a({payload:{appId:t,origins:n,user:c,permit:d,scope:e},lifespan:s.access}),refreshToken:a({payload:{userId:c.userId},lifespan:s.refresh})})}({userId:a,tables:e,scope:{core:!0},appId:n.appId,origins:n.origins,lifespans:t.crypto.tokenLifespans,permissionsEngine:ri({isPlatform:n.appId===t.platform.appDetails.appId,permissionsTables:e.permissions}),signToken:i,generateNickname:s});return await e.user.latestLogin.update({...lt({userId:a}),upsert:{userId:a,time:Date.now()}}),l}}),ui={nickname:qt((e=>"string"!=typeof e?["must be a string"]:[]),Mt(1),Ot(24),(e=>e.length>0&&0===e.trim().length?["can't be all whitespace"]:[])),tagline:qt((e=>"string"!=typeof e?["must be a string"]:[]),Mt(0),Ot(32),(e=>e.length>0&&0===e.trim().length?["can't be all whitespace"]:[]))},hi=Rt({...ui}),mi=({config:e})=>({async setProfile({access:e,tables:t,checker:i},{userId:o,profileDraft:n}){const s=e.user.userId===o,r=i.hasPrivilege("edit any profile");if(!(s||r))throw new je(403,"forbidden: you are not allowed to edit this profile");Bt(hi(n)),await t.user.profile.update({...lt({userId:o}),write:{nickname:n.nickname,tagline:n.tagline}})}}),fi=({config:e,signToken:t,verifyToken:i})=>({async authorize({bakeTables:o},{appId:n,scope:s,refreshToken:r}){const a=await o(n),l=ri({isPlatform:n===e.platform.appDetails.appId,permissionsTables:a.permissions}),c=await a.app.app.one(lt({appId:n}));if(!c)throw new je(400,"incorrect app id");if(c.archived)throw new je(403,"app has been archived");if(r){const{userId:o}=await i(r),d=await Wt({userId:o,permissionsEngine:l,authTables:a});await a.user.latestLogin.update({...lt({userId:o}),upsert:{userId:o,time:Date.now()}});const p=await l.getUserPrivileges(o);return t({lifespan:e.crypto.tokenLifespans.access,payload:{user:d,scope:s,permit:{privileges:p},appId:n,origins:zt(c.origins)}})}{const i=await l.getAnonymousPrivileges();return t({lifespan:e.crypto.tokenLifespans.access,payload:{user:void 0,appId:n,scope:s,origins:zt(c.origins),permit:{privileges:i}}})}}});async function gi({config:e,access:t,permissionsTables:i}){return ri({permissionsTables:i,isPlatform:t.appId===e.platform.appDetails.appId}).getPermissionsDisplay()}const vi=qt((e=>"string"!=typeof e?["must be a string"]:[]),Mt(1),Ot(16),(e=>e.length>0&&0===e.trim().length?["can't be all whitespace"]:[])),bi=({config:e,rando:t})=>({fetchPermissions:async({tables:t,access:i})=>gi({config:e,access:i,permissionsTables:t.permissions}),async createRole({tables:e},{label:i}){const o=vi(i);if(o.length)throw new je(400,`validation error on label: ${o.join("; ")}`);await e.permissions.role.create({label:i,hard:!1,public:!0,assignable:!0,roleId:t.randomId()})},async deleteRole({tables:e},{roleId:t}){const i=await e.permissions.role.one(lt({roleId:t}));if(!i)throw new je(404,"role not found");if(i.hard)throw new je(400,"cannot delete hard role");await Promise.all([e.permissions.userHasRole.delete(lt({roleId:t})),e.permissions.role.delete(lt({roleId:t}))])},async assignPrivilege({tables:e},{roleId:t,privilegeId:i}){await e.permissions.roleHasPrivilege.update({...lt({roleId:t,privilegeId:i}),upsert:{roleId:t,privilegeId:i,active:!0,immutable:!1}})},async unassignPrivilege({tables:e},{roleId:t,privilegeId:i}){await e.permissions.roleHasPrivilege.update({...lt({roleId:t,privilegeId:i}),upsert:{roleId:t,privilegeId:i,active:!1,immutable:!1}})}}),yi=ni.roles.admin.roleId;async function wi({email:e,tablesForApp:t,rando:i,config:o,generateNickname:n}){const{userId:s}=await di({rando:i,email:e,config:o,tables:t,generateNickname:n});await t.permissions.userHasRole.assert({...lt({userId:s,roleId:yi}),make:async()=>({userId:s,roleId:yi,hard:!1,public:!0,timeframeEnd:void 0,timeframeStart:void 0})})}const xi=At(qt((e=>"string"!=typeof e?["must be a string"]:[]),Ot(256),Et())),ki=ni.roles.admin.roleId,Si=({rando:e,config:t,generateNickname:i})=>({async listAdmins(e,{appId:t}){const i=await e.getTablesNamespacedForApp(t),o=await i.permissions.userHasRole.read(lt({roleId:ki}));return(await i.user.accountViaEmail.read(lt(...o.map((({userId:e})=>({userId:e})))))).map((({userId:e,email:t})=>({userId:e,email:t})))},async assignPlatformUserAsAdmin(o,{appId:n,platformUserId:s}){const r=o.tables,a=await o.getTablesNamespacedForApp(n),l=await r.user.accountViaEmail.one(lt({userId:s}));if(!l)throw new je(404,"platform email account not found");const{email:c}=l;await wi({rando:e,config:t,email:c,tablesForApp:a,generateNickname:i})},async assignAdmin(o,{appId:n,email:s}){const r=await o.getTablesNamespacedForApp(n),a=xi(s);if(a.length)throw new je(400,"email failed validation: "+a.join(";"));await wi({rando:e,config:t,email:s,tablesForApp:r,generateNickname:i})},async revokeAdmin(e,{appId:t,userId:i}){const o=await e.getTablesNamespacedForApp(t);await o.permissions.userHasRole.delete(lt({userId:i,roleId:ki}))}}),Ii=({tables:e,authPolicies:t,...i})=>({greenService:It()({policy:t.green,expose:fi(i)}),loginService:It()({policy:t.anon,expose:pi(i)}),appService:It()({policy:t.platformUser,expose:Ht(i)}),appEditService:It()({policy:t.appOwner,expose:{async updateApp({tables:e,access:t},{appId:i,appDraft:o}){Bt(Dt(o)),await e.app.app.update({...lt({appId:i}),whole:{appId:i,home:o.home,label:o.label,origins:Ut(o.origins),archived:!1}})},async deleteApp({tables:e,access:t},{appId:i}){await e.app.app.update({...lt({appId:i}),write:{archived:!0}})}}}),manageAdminsService:It()({policy:t.appOwner,expose:Si(i)}),personalService:It()({policy:t.user,expose:mi(i)}),userService:It()({policy:t.anon,expose:ai(i)}),permissionsService:It()({policy:t.userWhoManagesPermissions,expose:bi(i)})});var $i;!function(e){var t;(t=e.Mode||(e.Mode={}))[t.None=0]="None",t[t.Loading=1]="Loading",t[t.Error=2]="Error",t[t.Ready=3]="Ready"}($i||($i={}));const Pi={none:()=>({mode:$i.Mode.None}),loading:()=>({mode:$i.Mode.Loading}),error:e=>({mode:$i.Mode.Error,reason:e}),ready:e=>({mode:$i.Mode.Ready,value:e}),replaceValue:(e,t)=>e.mode===$i.Mode.Ready?{...e,value:t}:e,isNone:e=>e.mode===$i.Mode.Ready,isLoading:e=>e.mode===$i.Mode.Loading,isError:e=>e.mode===$i.Mode.Error,isReady:e=>e.mode===$i.Mode.Ready,value:e=>e.mode===$i.Mode.Ready?e.value:void 0,select(e,t){switch(e.mode){case $i.Mode.None:return t.none();case $i.Mode.Loading:return t.loading();case $i.Mode.Error:return t.error(e.reason);case $i.Mode.Ready:return t.ready(e.value)}},async operation({promise:e,errorReason:t="an error occurred",setOp:i}){i(Pi.loading());try{const t=await e;return i(Pi.ready(t)),t}catch(e){throw i(Pi.error(t)),e}},mode:e=>Pi.select(e,{none:()=>"none",loading:()=>"loading",error:()=>"error",ready:()=>"ready"}),debug:e=>Pi.select(e,{none:()=>["<op {mode: None}>"],loading:()=>["<op {mode: Loading}>"],error:e=>[`<op {mode: Error, reason: "${e}"}>`],ready:e=>["<op {mode: Ready, value: ",e,"}>"]})};function Ai(e,t){let i,o;return(...n)=>{if(i=n,!o){const n=()=>{t(...i),o=void 0};o=setTimeout(n,e)}}}function Ri(e){return JSON.parse(JSON.stringify(e))}function _i(e){Object.freeze(e);for(const t of Object.values(e))t&&"object"==typeof t&&_i(t);return e}const qi=e=>null!=e;function Ci(e,t){if(!qi(e)||!qi(t))return e===t;for(const[i,o]of Object.entries(e)){if(!t.hasOwnProperty(i))return!1;const e=t[i];switch(typeof o){case"object":if(!Ci(o,e))return!1;break;case"function":if(!qi(e)||o.toString()!==e.toString())return!1;break;default:if(o!==e)return!1}}for(const[i]of Object.entries(e))if(!t.hasOwnProperty(i))return!1;for(const[i]of Object.entries(t))if(!e.hasOwnProperty(i))return!1;return!0}function Mi({state:e,actions:t}){let i=_i(Ri(e));const o=t(e),{publish:n,subscribe:s,dispose:r}=We(),a=Ai(1,n),l={};for(const[t,n]of Object.entries(o))l[t]=(...t)=>{n(...t),i=_i(Ri(e)),a()};return{actions:l,onStateChange:s,clearStateListeners:r,getState:()=>i}}function Oi({appService:e,appEditService:t,manageAdminsService:i,getAccess:o}){const{actions:n,getState:s,onStateChange:r}=Mi({state:{active:!1,appRecords:Pi.none(),addingNewApp:Pi.none()},actions:e=>({setActive(t){e.active=t},setAddingNewApp(t){e.addingNewApp=t},setAppRecords(t){const i=Pi.value(t)??[];let o={};for(const e of i)o[e.appId]=Pi.ready(e);e.appRecords=Pi.replaceValue(t,o)},setIndividualAppRecord(t,i){if(Pi.isLoading(e.appRecords))throw new Error("cannot set individual app while apps are loading");const o=Pi.value(e.appRecords)??{};e.appRecords=Pi.ready({...o,[t]:i})},deleteIndividualAppRecord(t){if(!Pi.isReady(e.appRecords))throw new Error("cannot delete individual app while apps are loading");{const i=Pi.value(e.appRecords),o={};for(const[e,n]of Object.entries(i))e!==t&&(o[e]=n);e.appRecords=Pi.ready(o)}}})});async function a(){return(await o())?.user?.userId}async function l(){n.setActive(!0);return Pi.operation({promise:(async()=>{const t=await a();return t?e.listApps({ownerUserId:t}):[]})(),setOp:e=>n.setAppRecords(e)})}return{get state(){return s()},getApp(e){const t=Pi.value(s().appRecords);return t?Pi.value(t[e]):void 0},onStateChange:r,loadApps:l,deleteApp:async function(e){await Pi.operation({promise:t.deleteApp({appId:e}),setOp:t=>{n.setIndividualAppRecord(e,Pi.replaceValue(t,function(e){const t=Pi.value(s().appRecords);return t?Pi.value(t[e]):void 0}(e)))}}),n.deleteIndividualAppRecord(e)},updateApp:async function(e,i){const o=Pi.value(s().appRecords);if(!o)throw new Error("cannot update app while loading records");const r=Pi.value(o[e]);if(!r)throw new Error("cannot update app not present in records");return Pi.operation({promise:t.updateApp({appId:e,appDraft:i}),setOp:t=>n.setIndividualAppRecord(e,Pi.replaceValue(t,{...r,...i}))})},registerApp:async function(t){const o=await a();return await Pi.operation({errorReason:"failed to register app",promise:(async()=>{const n=await e.registerApp({appDraft:t,ownerUserId:o});return await i.assignPlatformUserAsAdmin({appId:n.appId,platformUserId:o}),n})(),setOp:e=>{if(n.setAddingNewApp(Pi.replaceValue(e,null)),Pi.isReady(e)){const i={...Pi.value(e),...t};n.setIndividualAppRecord(i.appId,Pi.ready(i))}}})},manageAdminsService:i,async accessChange(){s().active&&await l()}}}class Ti extends Error{constructor(e){super(`an effect changes an observable, named "${e.key}", that triggers that same effect, causing an infinite circle`)}}class Ei extends Error{constructor(e){super(`cannot set observable, named "${e}", outside a formalized action`)}}function Li(){const e={observableRecords:new Map,newObservablesSchedule:[],activeAction:void 0,activeStakeout:void 0};function t(t){if(e.observableRecords.has(t))return e.observableRecords.get(t);{const i={};return e.observableRecords.set(t,i),i}}return{context:e,subscribe:function(e){const{object:i,key:o,stakeout:n}=e,s=t(i),r=s[o]??[];return s[o]=[...r,n],{subscription:e,record:s}},triggerObservation:function(i,o){!function(t,i){const o=e.newObservablesSchedule.find((e=>e.object===t&&e.key===i));if(o)throw new Ti(o)}(i,o);const n=t(i)[o]??[];for(const{watcher:e,effect:t}of n)t?t(e()):e()}}}function Ni(){const{context:e,subscribe:t,triggerObservation:i}=Li();function o(t){return new Proxy(t,{get:(i,o)=>(e.activeStakeout&&e.newObservablesSchedule.push({object:t,key:o,stakeout:e.activeStakeout}),t[o]),set(o,n,s){const r=t[n];t[n]=s;const a=s!==r;if(!e.activeAction)throw new Ei(n);return a&&i(t,n),!0}})}function n(i){let o=()=>{},n=()=>{};e.activeStakeout=i,e.newObservablesSchedule=[];try{const s=i.watcher();n=i.effect?()=>i.effect(s):n;const r=e.newObservablesSchedule.map((e=>t(e)));o=()=>{for(const{subscription:{key:e},record:t}of r){const o=t[e]??[];t[e]=o.filter((e=>e!==i))}}}finally{e.activeStakeout=void 0,e.newObservablesSchedule=[],n()}return o}function s(t){return(...i)=>{e.activeAction=t;const o=t(...i);return e.activeAction=void 0,o}}return{observable:o,state:function e(t){for(const[i,o]of Object.entries(t))null===o||"object"!=typeof o||Array.isArray(o)||(t[i]=e(o));return o(t)},track:n,watch:function(e,t){return n({watcher:e,effect:t})},action:s,actions:function e(t){return Ke(t,(t=>null!==t&&"object"==typeof t?e(t):"function"==typeof t?s(t):t))},dispose:function(){e.observableRecords=new Map},runInAction:function(t){e.activeAction=t,t(),e.activeAction=void 0}}}function ji({questionsReadingService:e,questionsPostingService:t,questionsModerationService:i,getAccess:o}){const{actions:n,getState:s,onStateChange:r}=Mi({state:{access:void 0,users:[],questions:[],boardOps:{},postingOp:Pi.ready(void 0)},actions:e=>({setAccess(t){e.access=t},setBoardOp(t,i){e.boardOps={...e.boardOps,[t]:i}},setPostingOp(t){e.postingOp=t},addUsers(t){e.users=[...Qt(t,e.users,((e,t)=>e.userId===t.userId))]},addQuestions(t){e.questions=[...Qt(t,e.questions,((e,t)=>e.questionId===t.questionId))]},setQuestionLike(t,i){e.questions=e.questions.map((e=>e.questionId===t?{...e,liked:i,likes:e.liked===i?e.likes:i?e.likes+1:e.likes-1}:{...e}))},setQuestionReport(t,i){e.questions=e.questions.map((e=>e.questionId===t?{...e,reported:i,reports:e.reported===i?e.reports:i?e.reports+1:e.reports-1}:{...e}))},setQuestionArchive(t,i){e.questions=e.questions.map((e=>e.questionId===t?{...e,archive:i}:{...e}))}})});async function a(t){await Pi.operation({promise:(async()=>{const{users:i,questions:o}=await e.fetchQuestions({board:t});n.addUsers(i),n.addQuestions(o)})(),setOp:e=>n.setBoardOp(t,e)})}return{onStateChange:r,makeBoardModel:function(e){return{getPermissions(){const{access:e}=s();return{"read questions":!!e&&e.permit.privileges.includes(ni.privileges["read questions"]),"post questions":!!e&&(e.permit.privileges.includes(ni.privileges["post questions"])&&!e.permit.privileges.includes(ni.privileges.banned)),"moderate questions":!!e&&e.permit.privileges.includes(ni.privileges["moderate questions"])}},getBoardName:()=>e,getAccess:()=>s().access,getBoardOp:()=>s().boardOps[e],getPostingOp:()=>s().postingOp,getQuestions:()=>s().questions.filter((t=>t.board===e)).filter((e=>!1===e.archive)),getUser:e=>s().users.find((t=>t.userId===e)),async loadQuestions(){await a(e)},async postQuestion(e){const i=await Pi.operation({promise:t.postQuestion({questionDraft:e}),setOp:e=>n.setPostingOp(Pi.replaceValue(e,void 0))});n.addQuestions([i]);const s=Pi.value(o());n.addUsers([s.user])},async likeQuestion(e,i){await t.likeQuestion({like:i,questionId:e}),n.setQuestionLike(e,i)},async reportQuestion(e,i){await t.reportQuestion({report:i,questionId:e}),n.setQuestionReport(e,i)},async archiveQuestion(e,i){await t.archiveQuestion({archive:i,questionId:e}),n.setQuestionArchive(e,i)},async archiveBoard(){await i.archiveBoard({board:e});for(const e of s().questions)n.setQuestionArchive(e.questionId,!0)}}},accessChange:e=>{n.setAccess(e),e?.user&&n.addUsers([e.user]),async function(){const e=s();await Promise.all(Object.keys(e.boardOps).map(a))}()}}}function Di({roleAssignmentService:e,reauthorize:t}){const{actions:i,getState:o,onStateChange:n}=Mi({state:{access:void 0,permissionsOp:Pi.none()},actions:e=>({setAccess(t){e.access=t},setPermissionsOp(t){e.permissionsOp=t}})});let s=!1;function r(){return function(e,t){const i={};for(const[o,n]of Object.entries(t))i[o]=!!e&&e.permit.privileges.includes(n);return e=>i[e]}(o().access,ni.privileges)}async function a(){s&&r()("administrate user roles")&&await Pi.operation({promise:e.fetchPermissions(),setOp:i.setPermissionsOp})}return{getState:o,onStateChange:n,initialize:async function(){s=!0,await a()},get isAllowed(){return r()},accessChange:e=>{i.setAccess(e),a()},reauthorize:t,searchUsers:e.searchUsers,assignRoleToUser:e.assignRoleToUser,revokeRoleFromUser:e.revokeRoleFromUser}}async function Ui({appId:e,remote:t,popups:i,storage:o,authMediator:n}){const s=function({authMediator:e,loginService:t}){const i=Ni(),o=i.state({access:Pi.none()}),n=i.actions({setAccess(e){o.access=e}});async function s(e){return Pi.operation({promise:e,setOp:e=>n.setAccess(e)})}return e.subscribeToAccessChange((e=>{n.setAccess(Pi.ready(e))})),{track:i.track,get access(){return o.access},onAccessChange:e.subscribeToAccessChange,getValidAccess:async()=>e.getAccess(),async useExistingLogin(){await s(e.initialize())},sendLoginLink:async e=>t.sendLoginLink({email:e}),async login(i){try{Je(i)?await s(t.authenticateViaLoginToken({loginToken:i}).then((t=>e.login(t)))):n.setAccess(Pi.error("login link expired"))}catch(e){console.error(e),n.setAccess(Pi.error("error with login"))}},async logout(){await Pi.operation({promise:e.logout(),setOp:e=>n.setAccess(e)})},async reauthorize(){await s(e.reauthorize())}}}({authMediator:n,loginService:t.auth.loginService}),{getValidAccess:r,reauthorize:a}=s,l=function({personalService:e,getAccess:t,reauthorize:i}){const o=Ni(),n=o.state({submitDraftOp:Pi.ready(void 0)}),s=o.actions({setSubmitDraft(e){n.submitDraftOp=e}});return{get submitDraftOp(){return n.submitDraftOp},async saveProfile(o){await Pi.operation({promise:(async()=>{const{user:{userId:n}}=await t();await e.setProfile({userId:n,profileDraft:o}),await i()})(),errorReason:"error saving profile",setOp(e){s.setSubmitDraft(e)}})}}}({reauthorize:a,getAccess:r,personalService:t.auth.personalService}),c=Oi({getAccess:r,appService:t.auth.appService,appEditService:t.auth.appEditService,manageAdminsService:t.auth.manageAdminsService}),d=function({permissionsService:e,reauthorize:t}){const{getState:i,actions:o,onStateChange:n}=Mi({state:{active:!1,access:void 0,permissionsDisplay:Pi.none()},actions:e=>({setActive(t){e.active=t},setPermissionsDisplay(t){e.permissionsDisplay=t},setAccess(t){e.access=t}})});async function s(){await Pi.operation({promise:Promise.resolve().then((async()=>r()?e.fetchPermissions():void 0)),setOp:e=>o.setPermissionsDisplay(e)})}function r(){const{access:e}=i();return!!e?.user&&e.permit.privileges.includes(ni.privileges["customize permissions"])}function a(e){return async(...i)=>{const o=await e(...i);return await s(),await t(),o}}return{onStateChange:n,getState:i,initialize:async function(){o.setActive(!0),r()&&await s()},getUserCanCustomizePermissions:r,createRole:a(e.createRole),deleteRole:a(e.deleteRole),assignPrivilege:a(e.assignPrivilege),unassignPrivilege:a(e.unassignPrivilege),async accessChange(e){o.setAccess(e),e?.user&&i().active&&await s()}}}({permissionsService:t.auth.permissionsService,reauthorize:a}),p=Di({roleAssignmentService:t.administrative.roleAssignmentService,reauthorize:()=>s.reauthorize()}),u=ji({...t.questions,getAccess:()=>s.access});return s.onAccessChange((async e=>{await Promise.all([c.accessChange(),d.accessChange(e),u.accessChange(e),p.accessChange(e)])})),{appModel:c,authModel:s,personalModel:l,questionsModel:u,permissionsModel:d,administrativeModel:p}}function zi(){const e=new Map;return{read:async t=>e.get(t),async write(t,i){e.set(t,i)},async delete(t){e.delete(t)}}}function Bi({blueprint:e,path:t=[],process:i}){return et(e,((e,o)=>!0===e?i([...t,o]):Bi({blueprint:e,path:[...t,o],process:i})))}function Hi({blueprint:e,process:t}){return Bi({blueprint:e,process:t})}const Fi="_appId";function Vi(e){return t=>Ke(e,(e=>function(e,t){const i=e=>e?rt({equal:t},e):rt({equal:t});return{create:async(...i)=>e.create(...i.map((e=>({...e,...t})))),read:async t=>e.read({...t,conditions:i(t.conditions)}),one:async t=>e.one({...t,conditions:i(t.conditions)}),assert:async o=>e.assert({...o,conditions:i(o.conditions),make:async()=>({...await o.make(),...t})}),async update(o){const n=o;return e.update({...o,conditions:i(o.conditions),upsert:n.upsert?{...n.upsert,...t}:void 0,whole:n.whole?{...n.whole,...t}:void 0,write:n.write?{...n.write,...t}:void 0})},delete:async t=>e.delete({...t,conditions:i(t.conditions)}),count:async t=>e.count({...t,conditions:i(t.conditions)})}}(e,t)))}function Wi(e){return async function(t){return Vi(e)({[Fi]:t})}}async function Qi(e,t,i,o){const n=await o.processAuth(e,t);return{...n,questionsTables:await Wi(i)(n.access.appId)}}const Gi=e=>({policy:async(t,i)=>{const o=await function({authPolicies:e,questionsTables:t}){return async function(i,o){return Qi(i,o,t,e.anon)}}(e)(t,i);return o.checker.requirePrivilege("read questions"),o},expose:{async fetchQuestions({questionsTables:t,tables:i,access:o},{board:n}){const s=await t.questionPosts.read({...lt({board:n,archive:!1}),limit:100,offset:0,order:{timePosted:"descend"}});let r=[],a=[];if(s.length){const n=ri({isPlatform:o.appId===e.config.platform.appDetails.appId,permissionsTables:i.permissions});a=await Vt({permissionsEngine:n,authTables:i,userIds:s.map((e=>e.authorUserId))}),r=await async function({userId:e,posts:t,questionsTables:i}){const o=t.map((e=>e.questionId)),n=o.length?await i.questionLikes.read({conditions:at(...o.map((e=>({equal:{questionId:e}}))))}):[],s=o.length?await i.questionReports.read({conditions:at(...o.map((e=>({equal:{questionId:e}}))))}):[];return o.map((i=>{const o=t.find((e=>e.questionId===i)),r=n.filter((e=>e.questionId===i)),a=s.filter((e=>e.questionId===i)),l=r.find((t=>t.userId===e)),c=a.find((t=>t.userId===e));return{...o,likes:r.length,reports:a.length,liked:!!l,reported:!!c}}))}({posts:s,questionsTables:t,userId:o?.user?.userId})}return{questions:r,users:a}}}}),Xi=qt((e=>"string"!=typeof e?["must be a string"]:[]),Mt(10),Ot(280),(e=>e.length>0&&0===e.trim().length?["can't be all whitespace"]:[])),Ji=Rt({board:qt((e=>"string"!=typeof e?["must be a string"]:[]),Mt(1),Ot(32),(e=>e.length>0&&0===e.trim().length?["can't be all whitespace"]:[])),content:Xi});function Zi({authPolicies:e,questionsTables:t}){return async function(i,o){return Qi(i,o,t,e.user)}}const Yi=e=>({policy:async(t,i)=>{const o=await Zi(e)(t,i);return o.checker.requirePrivilege("post questions"),o.checker.requireNotHavePrivilege("banned"),o},expose:{async postQuestion({questionsTables:t,access:i,checker:o},{questionDraft:n}){o.requirePrivilege("post questions"),Bt(Ji(n));const s={questionId:e.rando.randomId(),authorUserId:i.user.userId,archive:!1,timePosted:Date.now(),...n};return await t.questionPosts.create(s),{...s,likes:0,reports:0,liked:!1,reported:!1}},async archiveQuestion({access:{user:{userId:e}},questionsTables:t,checker:i},{questionId:o,archive:n}){!function({userId:e,questionPost:t,checker:i}){const o=i.hasPrivilege("moderate questions"),n=t.authorUserId===e;if(!o&&!n)throw new Error("user is not authorized to edit question")}({userId:e,checker:i,questionPost:await t.questionPosts.one(lt({questionId:o}))}),await t.questionPosts.update({...lt({questionId:o}),write:{archive:!!n}})},async likeQuestion({questionsTables:e,checker:t,access:{user:{userId:i}}},{questionId:o,like:n}){t.requirePrivilege("like questions");const s=await e.questionLikes.count(lt({questionId:o,userId:i}))>0;n&&!s?await e.questionLikes.create({userId:i,questionId:o}):!n&&s&&await e.questionLikes.delete(lt({userId:i,questionId:o}))},async reportQuestion({questionsTables:e,checker:t,access:{user:{userId:i}}},{questionId:o,report:n}){t.requirePrivilege("report questions");const s=await e.questionReports.count(lt({questionId:o,userId:i}))>0;n&&!s?await e.questionReports.create({userId:i,questionId:o}):!n&&s&&await e.questionReports.delete(lt({userId:i,questionId:o}))}}});function Ki(e){return It()({policy:{processAuth:e.policy},expose:e.expose})}const eo=e=>({policy:async(t,i)=>{const o=await Zi(e)(t,i);return o.checker.requirePrivilege("moderate questions"),o.checker.requireNotHavePrivilege("banned"),o},expose:{async archiveBoard({questionsTables:e},{board:t}){await e.questionPosts.update({...lt({board:t}),write:{archive:!0}})}}});function to(e){return{questionsReadingService:Ki(Gi(e)),questionsPostingService:Ki(Yi(e)),questionsModerationService:Ki(eo(e))}}function io(e){const t=function(e){return{read(t){let i;const o=e.getItem(t);if(o)try{i=JSON.parse(o)}catch(i){e.removeItem(t)}return i},write(t,i){const o=JSON.stringify(i);e.setItem(t,o)},delete(t){e.removeItem(t)}}}(e);return{read:async e=>t.read(e),write:async(e,i)=>t.write(e,i),delete:async e=>t.delete(e)}}async function oo(e){const t=await ct(zi(),"");return e&&await t.create(...e),t}function no({frontTable:e,backTable:t}){async function i(i){return await t.one(i)??await e.one(i)}return{one:i,create:e.create,update:e.update,delete:e.delete,async read(i){const[o,n]=await Promise.all([t.read(i),await e.read(i)]);return[...o,...n]},assert:async t=>await i(t)||await(async()=>{const i=await t.make();return await e.create(i),i})(),async count(i){const[o,n]=await Promise.all([t.count(i),e.count(i)]);return o+n}}}function so({config:e,tables:t}){const i=function({config:e,appTables:t}){return async function(){const i=e.platform.appDetails;return{app:no({frontTable:t.app,backTable:await oo([{appId:i.appId,home:i.home,label:i.label,origins:Ut(i.origins),archived:!1}])}),appOwnership:t.appOwnership}}}({config:e,appTables:t.app});return async function(e){return{app:await i(),user:await Wi(t.user)(e),permissions:await Wi(t.permissions)(e)}}}function ro(e,t){function i(i){return e.privileges.includes(t[i])}return{hasPrivilege:i,requirePrivilege:function(e){if(!i(e))throw new je(403,`forbidden; privilege required "${e}"`)},requireNotHavePrivilege:function(e){if(i(e))throw new je(403,`forbidden: must not have privilege "${e}"`)}}}function ao({config:e,tables:t,verifyToken:i}){const o=so({config:e,tables:t}),n=function({tables:e}){return async function(t){async function i(i){if((await e.app.appOwnership.one(lt({appId:i}))).userId!==t)throw new je(403,"forbidden")}return{countUsers:async t=>(await i(t),e.user.account.count(lt({[Fi]:t}))),countUsersActiveDaily:async t=>{await i(t);const o=Date.now()-_e;return e.user.latestLogin.count({conditions:rt({equal:{_appId:t}},{greater:{time:o}})})},countUsersActiveMonthly:async t=>{await i(t);const o=Date.now()-2628e6;return e.user.latestLogin.count({conditions:rt({equal:{_appId:t}},{greater:{time:o}})})}}}}({tables:t}),s={processAuth:async({accessToken:e},t)=>{const n=await i(e);if(function(e,t){return!!e.headers.origin&&t.some((t=>t===e.headers.origin))}(t,n.origins))return{access:n,tables:await o(n.appId),checker:ro(n.permit,ni.privileges)};throw new je(403,"invalid origin")}},r={processAuth:async(e,t)=>{const i=await s.processAuth(e,t);if(i.access.user)return i;throw new je(403,"not logged in")}},a={processAuth:async(e,t)=>{const i=await r.processAuth(e,t);return i.checker.requirePrivilege("customize permissions"),i}},l={processAuth:async(t,i)=>{const o=await r.processAuth(t,i);if(o.access.appId==e.platform.appDetails.appId)return{...o,checker:ro(o.access.permit,oi.privileges),statsHub:await n(o.access.user.userId)};throw new je(403,"not platform app")}};return{green:{processAuth:async(e,t)=>({bakeTables:o})},anon:s,user:r,appOwner:{processAuth:async(e,i)=>{const n=await l.processAuth(e,i);return{...n,getTablesNamespacedForApp:async function(e){const i=n.checker.hasPrivilege("edit any app");if(async function({appId:e,access:t,tables:i}){const{userId:o}=t.user;return!!await i.app.appOwnership.one(lt({userId:o,appId:e}))}({appId:e,access:n.access,tables:t})||i)return o(e);throw new je(403,"forbidden: not privileged over app")}}}},platformUser:l,userWhoManagesPermissions:a}}function lo({rando:e,tables:t,webhooks:i}){const o=()=>e.randomId();function n(e){return{headers:{},lastResponse:void 0,...e}}const s={accounts:{async create(e){const i={id:o(),type:e.type,email:e.email};return await t.accounts.create(i),n(i)},retrieve:async e=>n(await t.accounts.one(lt({id:e})))},accountLinks:{create:async e=>n({url:"https://fake.xiome.io/stripe-account-setup"})}};async function r(e,t){return i[e]({type:e,data:{object:t}})}const a=t;return{stripeLiaisonForPlatform:s,connectStripeLiaisonForApp:function(e){const t=Vi(a)({_connectedAccount:e});function i(e){const t={};for(const[i,o]of Object.entries(e))void 0!==o&&(t[i]=o);return t}function s({table:e,createData:t,updateData:s,createHook:r,updateHook:a}){const l=function(e){return{create:({makeData:t,hook:i=(async()=>{})})=>async function(s){const r={id:o(),...t(s)};return await e.create(r),await i(r),n(r)},retrieve:()=>async function(t){return n(await e.one(lt({id:t})))},update:({makeData:t,hook:o=(async()=>{})})=>async function(s,r){await e.update({...lt({id:s}),write:i(t(r))});const a=await e.one(lt({id:s}));return await o(a),n(a)},delete:()=>async function(t){await e.delete(lt({id:t}))}}}(e);return{create:l.create({makeData:t,hook:r}),retrieve:l.retrieve(),update:l.update({makeData:s,hook:a}),delete:l.delete()}}return{customers:s({table:t.customers,createData:e=>({email:e.email,invoice_settings:e.invoice_settings??{default_payment_method:void 0}}),updateData:e=>({email:e.email,invoice_settings:e.invoice_settings})}),products:s({table:t.products,createData:e=>({name:e.name,description:e.description}),updateData:e=>({name:e.name,description:e.description})}),prices:s({table:t.prices,createData:e=>({product:e.product,currency:e.currency,unit_amount:e.unit_amount,recurring:e.recurring}),updateData:e=>({active:e.active})}),checkout:{sessions:s({table:t.checkoutSessions,createData:e=>({customer:e.customer}),updateData:e=>({}),createHook:async e=>{await r("checkout.session.completed",e)},updateHook:async e=>{await r("checkout.session.completed",e)}})},paymentMethods:s({table:t.paymentMethods,createData:e=>({type:e.type,customer:e.customer}),updateData:e=>({})}),setupIntents:s({table:t.setupIntents,createData:e=>({customer:e.customer,payment_method:e.payment_method,usage:e.usage}),updateData:e=>({payment_method:e.payment_method})}),subscriptions:s({table:t.subscriptions,createData:e=>({customer:e.customer,default_payment_method:e.default_payment_method,cancel_at_period_end:e.cancel_at_period_end,items:{url:"",object:"list",has_more:!1,data:e.items.map((e=>({id:o(),billing_thresholds:e.billing_thresholds,price:e.price,price_data:e.price_data,quantity:e.quantity,tax_rates:e.tax_rates})))}}),updateData:e=>({cancel_at_period_end:e.cancel_at_period_end,default_payment_method:e.default_payment_method}),updateHook:async e=>{await r("customer.subscription.updated",e)}})}}}}async function co({rando:e,tableStorage:t,tables:i}){const{publishers:o,subscribers:n}=function(e){const t={},i={};for(const[o,n]of Object.entries(e))t[o]=n.publish,i[o]=n.subscribe;return{publishers:t,subscribers:i}}({"checkout.session.completed":We(),"invoice.paid":We(),"invoice.payment_failed":We(),"customer.subscription.updated":We()}),s=await async function({tableStorage:e}){const t={prices:void 0,accounts:void 0,products:void 0,customers:void 0,setupIntents:void 0,subscriptions:void 0,paymentMethods:void 0,checkoutSessions:void 0};return await Pt(et(t,((t,i)=>ct(e,`mock-stripe-${i}`))))}({tableStorage:t}),r=lo({rando:e,tables:s,webhooks:o}),a=function({logger:e,stripeComplex:t,tables:i}){return{async"checkout.session.completed"(t){e.info("stripe-webhook checkout.session.completed:",t.data.object)},async"invoice.paid"(t){e.info("stripe-webhook invoice.paid:",t.data.object)},async"invoice.payment_failed"(t){e.info("stripe-webhook invoice.payment_failed:",t.data.object)},async"customer.subscription.updated"(t){e.info("stripe-webhook customer.subscription.updated:",t.data.object)}}}({stripeComplex:r,logger:console,tables:i});for(const[e,t]of Object.entries(n))t(a[e].bind(a));return{stripeComplex:r,mockStripeOperations:{linkBankWithExistingStripeAccount:async e=>{await s.accounts.update({...lt({id:e}),write:{payouts_enabled:!0,details_submitted:!0}})}}}}const po=At(qt((e=>"string"!=typeof e?["must be a string"]:[]),(uo=48,e=>e.length!==uo?[`length must be ${uo}`]:[])));var uo;const ho=_t((e=>void 0!==typeof e?["must be undefined or null"]:[]),(e=>"number"!=typeof e?["must be a number"]:[])),mo=At(qt((e=>"string"!=typeof e?["must be a string"]:[]),Mt(1),Ot(48)));function fo(e,t){const i=t(e);if(i.length>0)throw new je(400,i.join("; "));return e}const go=({config:e,authPolicies:t})=>({policy:async(e,i)=>{const o=await t.user.processAuth(e,i);return o.checker.requirePrivilege("administrate user roles"),o},expose:{fetchPermissions:async({tables:t,access:i})=>gi({config:e,access:i,permissionsTables:t.permissions}),async searchUsers({tables:t,access:i},o){const{term:n}=fo(o,Rt({term:mo})),s=new RegExp(n.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"i");const r=(await t.user.profile.read({limit:100,conditions:at({equal:{userId:n}},{search:{nickname:s}},{search:{tagline:s}})})).map((e=>e.userId));if(!r.length)return[];const a=ri({isPlatform:i.appId===e.platform.appDetails.appId,permissionsTables:t.permissions}),l=await Vt({userIds:r,permissionsEngine:a,authTables:t}),c=await a.getUsersHaveRoles({userIds:l.map((e=>e.userId)),onlyGetPublicRoles:!1});return l.map((e=>({user:e,roleIds:c.find((t=>t.userId===e.userId)).userHasRoles.map((e=>e.roleId))})))},async assignRoleToUser({tables:e},t){const{roleId:i,userId:o,isPublic:n,timeframeEnd:s,timeframeStart:r}=fo(t,Rt({roleId:po,userId:po,isPublic:At((e=>"boolean"!=typeof e?["must be a boolean"]:[])),timeframeEnd:ho,timeframeStart:ho}));if((await e.permissions.userHasRole.one(lt({userId:o,roleId:i})))?.hard)throw new je(400,"hard role assignment cannot be overwritten");await e.permissions.userHasRole.assert({conditions:at({equal:{roleId:i,userId:o}}),make:async()=>({hard:!1,public:n,roleId:i,userId:o,timeframeEnd:s,timeframeStart:r})})},async revokeRoleFromUser({tables:e},t){const{roleId:i,userId:o}=fo(t,Rt({roleId:po,userId:po}));if((await e.permissions.userHasRole.one(lt({userId:o,roleId:i})))?.hard)throw new je(400,"hard role assignment cannot be overwritten");await e.permissions.userHasRole.delete({conditions:at({equal:{roleId:i,userId:o}})})}}});const vo=async e=>console.log(`\n\n====== EMAIL ======\nto: ${e.to}\nsubject: ${e.subject}\ntime: ${(new Date).toLocaleString()}\n\n${e.body}\n\n===================\n\n`),bo={colors:["Red","Yellow","Green","Cyan","Blue","Magenta","Dark","Grey","Silver","Bright","Light","Gold","Golden","Aqua","Minty"],animals:["Aardvark","Mongoose","Alligator","Robin","Monkey","Seahorse","Shark","Leopard","Eagle","Raven","Owl","Hawk","Duck","Wolf","Coyote","Dingo","Ostrich","Llama","Alpaca","Zebra","Bear","Kiwi","Penguin","Otter","Dolphin","Starfish","Sunfish","Salmon","Swordfish","Sparrow","Turtle","Puppy","Kitten"],adjectives:["Funny","Charming","Wonderful","Fancy","Whimsical","Gregarious","Curious","Fabulous","Saavy","Groovy","Happy","Snappy","Quick","Super","Fast","Fuzzy","Clever","Genius","Marvelous","Eccentric","Fantastic","Quaint","Young","Wise","Creative","Helpful","Nice","Sincere","Loyal","Honest","Truthful","Thoughtful","Clean","Friendly","Gentle","Pleasant","Brilliant","Polite","Original","Ambitious","Lively","Wholesome","Cordial","Eager","Relaxed","Skilled","Tidy","Calm","Hopeful","Positive","Social","Quick","Fearless","Daring","Bold","Quiet"]};class yo extends Error{constructor(e){super(e)}}function wo(e){return function(){throw new yo(e)}}const xo=(ko={configureMongo:wo("config.database.mongo not supported in browser"),configureMailgun:wo("config.email.mailgun not supported in browser"),configureTokenFunctions:wo("config.crypto.keys must be 'mock-mode' in browser"),configureMockFileStorage:wo("config.database 'mock-file' not supported in browser")},async function(e){const t=await async function({isNode:e=bt}={}){const t=e?await(async()=>{const e=await import("crypto");return t=>e.randomBytes(t).buffer})():e=>crypto.getRandomValues(new Uint8Array(e)).buffer;function i(){const e=t(8),i=new Int8Array(e);return i[7]=63,i[6]|=240,new DataView(e).getFloat64(0,!0)-1}function o(e){return e[Math.floor(i()*e.length)]}return{random:i,compare:e?await(async()=>{const e=await import("crypto");return(t,i)=>e.timingSafeEqual(Buffer.from(t,"utf8"),Buffer.from(i,"utf8"))})():(e,t)=>(console.warn("insecure compare"),e===t),randomId:function(){return xt(t(32))},randomBuffer:t,randomSample:o,randomSequence:function(e,t){const i=[];for(;i.length<e;){const e=o(t);i.push(e)}return i.join("")}}}(),i=await(async()=>{let t;t="mock-console"===e.email?vo:ko.configureMailgun(e.email).sendEmail;const i=function(e){let t=!0;return{sendEmail:async i=>{if(t)return e(i)},enableEmails(){t=!0},disableEmails(){t=!1}}}(t);t=i.sendEmail;const{disableEmails:o,enableEmails:n}=i,{sendLoginEmail:s,recallLatestLoginEmail:r}=function(e){let t;return{sendLoginEmail:async i=>{t=i,await e(i)},recallLatestLoginEmail:()=>t}}(function({sendEmail:e}){return async function({to:t,appHome:i,appLabel:o,lifespan:n,legalLink:s,loginToken:r,platformLink:a}){const l=function({home:e,loginToken:t}){return`${e}?login=${t}`}({loginToken:r,home:i}),c=(n/Re).toFixed(0);return e({to:t,subject:`Login to ${o}`,body:`\nLogin link for ${o} (expires in ${c} minutes)\n\n » ${l} «\n\nIf you didn't request this login link, just ignore it\n\n * logins powered by ${a} *\n * policies and terms of service ${s} *\n`})}}({sendEmail:t}));return{sendEmail:t,enableEmails:n,disableEmails:o,sendLoginEmail:s,recallLatestLoginEmail:r}})(),{database:o,mockStorage:n}=await(async()=>{const t={core:{app:{app:!0,appOwnership:!0},permissions:{privilege:!0,role:!0,roleHasPrivilege:!0,userHasRole:!0},user:{account:!0,accountViaEmail:!0,accountViaGoogle:!0,latestLogin:!0,profile:!0}},questions:{questionLikes:!0,questionPosts:!0,questionReports:!0},store:{billing:{customers:!0,storeInfo:!0,subscriptions:!0,subscriptionPlans:!0},merchant:{stripeAccounts:!0}}};async function i(e){return{mockStorage:e,database:await vt(Hi({blueprint:t,process:t=>ct(e,t.join("-"))}))}}switch(e.database){case"mock-file":return i(ko.configureMockFileStorage("./data.json"));case"mock-memory":return i(zi());case"mock-localstorage":return i(io(window.localStorage));default:return ko.configureMongo({blueprint:t,config:{...e,database:e.database}})}})(),{signToken:s,verifyToken:r}=await(async()=>"mock-mode"===e.crypto.keys?{signToken:async({payload:e,lifespan:t})=>{const i={payload:e,iat:Date.now()/1e3,exp:(Date.now()+t)/1e3};return[st({alg:null,typ:"JWT"}),st(i),st("fake-mock-token-signature")].join(".")},verifyToken:async e=>{const t=Xe(e),i=1e3*t.exp;if(Date.now()>i)throw new Error("token expired");return t.payload}}:ko.configureTokenFunctions(e.crypto.keys))(),{stripeComplex:a,mockStripeOperations:l}=await co({rando:t,tableStorage:n,tables:{...o.core,...o.store}}),c=await(async()=>{const n=function({rando:e}){return function({rando:e,delimiter:t,dictionary:i,nicknameStructure:o}){const n=o.map((e=>e.reduce(((e,t)=>[...e,...i[t]]),[])));return()=>n.map((t=>e.randomSample(t))).join(t)}({rando:e,delimiter:" ",dictionary:bo,nicknameStructure:[["adjectives","colors"],["animals"]]})}({rando:t}),a=ao({config:e,tables:o.core,verifyToken:r});return{auth:Ii({rando:t,config:e,authPolicies:a,tables:o.core,signToken:s,verifyToken:r,generateNickname:n,sendLoginEmail:i.sendLoginEmail}),administrative:(l={config:e,authTables:o.core,authPolicies:a},{roleAssignmentService:Ki(go(l))}),questions:to({rando:t,config:e,authPolicies:a,questionsTables:o.questions})};var l})();return{api:c,config:e,emails:i,database:o,stripeComplex:a,mockStripeOperations:l,platformAppId:e.platform.appDetails.appId,mockBrowser:async()=>async function({api:e,mockStripeOperations:t}){return{mockAppWindow:async function({appId:i,apiLink:o,latency:n,windowLink:s}){const r=zi(),{remote:a,authMediator:l}=it({api:e,appId:i,apiLink:o,latency:n,storage:r,origin:new URL(s).origin}),{modals:c,nextModalResults:d}=function(){const e={confirm:!0,prompt:void 0};return{modals:{popup:()=>({controls:{close(){},rerender(){}},modal:{}}),confirm:async()=>e.confirm,prompt:async()=>e.prompt},nextModalResults:e}}();return{models:await Ui({appId:i,remote:a,storage:r,authMediator:l,popups:Ae({mockStripeOperations:t})}),remote:a,nextModalResults:d}}}}({api:c,mockStripeOperations:l})}});var ko;async function So({origins:e,latency:t,storage:i,appWindowLink:o}){const n=await xo(qe({platformHome:o,platformOrigins:e}));n.emails.disableEmails();const s=Pe+"/",r="creative@xiome.io";let a=await i.read("mock-app");a||(a=await async function({apiLink:e,ownerEmail:t,appOrigins:i,backend:o}){const n=await o.mockBrowser(),s=await n.mockAppWindow({apiLink:e,latency:!1,appId:o.platformAppId,windowLink:window.location.href}),{authModel:r,appModel:a}=s.models;await r.sendLoginLink(t),await r.login(o.emails.recallLatestLoginEmail().loginToken);const{appId:l}=await a.registerApp({label:"Mock App",home:window.location.href,origins:i});return console.log("mock: register app",l),l}({apiLink:s,backend:n,ownerEmail:r,appOrigins:e}),await i.write("mock-app",a)),console.log(`mock: app owner email "${r}"`),n.emails.enableEmails();const{remote:l,authMediator:c}=await nt({appId:a,apiLink:s,backend:n,storage:i,latency:t,appWindowLink:o});return{appId:a,remote:l,authMediator:c,backend:n,popups:Ae({mockStripeOperations:n.mockStripeOperations})}}function Io(e){for(const[t,i]of Object.entries(e))customElements.define(t.replace(/([a-zA-Z])(?=[A-Z])/g,"$1-").toLowerCase(),i)}var $o=function(e,t,i,o){if("a"===i&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?o:"a"===i?o.call(e):o?o.value:t.get(e)},Po=function(e,t,i,o,n){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?n.call(e,i):n?n.value=i:t.set(e,i),i};function Ao(e){return class extends e{connectedCallback(){super.connectedCallback(),this.hasAttribute("initially-hidden")&&this.removeAttribute("initially-hidden")}}}function Ro(...e){return function(t){return class extends t{firstUpdated(t){super.firstUpdated(t);for(const t of e)this.subscribeAutotrack(t)}}}}function _o(e){return class extends e{connectedCallback(){super.connectedCallback(),this.setAttribute("focusable","")}}}function qo(e){return function(t){return class extends t{get share(){return e}}}}function Co(e){return[e].flat()}const Mo=e=>void 0!==e;function Oo(...e){return function(t){var i;return(i=class extends t{}).styles=function(e,t){return[...Co(e)??[],...Co(t)].flat().filter(Mo)}(t.styles,e),i}}class To extends(function(e){var t,i;return i=class extends e{constructor(){super(...arguments),this.auto=Ni(),t.set(this,[]),this.subscribeAutotrack=e=>{$o(this,t,"f").push(e({watcher:()=>this.render(),effect:()=>this.requestUpdate()}))}}render(){}firstUpdated(e){this.subscribeAutotrack(this.auto.track)}dispose(){for(const e of $o(this,t,"f"))e();Po(this,t,[],"f"),this.auto.dispose()}},t=new WeakMap,i}(Ao(le))){init(){}firstUpdated(e){this.init(),super.firstUpdated(e)}}class Eo extends To{constructor(){if(super(),void 0===this.share)throw new Error("component requires share")}}class Lo extends(Ao(le)){init(){}firstUpdated(e){super.firstUpdated(e),this.init()}}class No extends Lo{constructor(){if(super(),void 0===this.share)throw new Error("component requires share")}}var jo=re`

* {
	margin: 0;
	padding: 0;
	box-sizing: border-box;
}

*:focus {
	outline: var(--focus-outline, 3px solid cyan);
}

`,Do=re`

button {
	font-size: unset;
	color: unset;
	background: transparent;
}

.container {
	position: relative;
	display: flex;
	flex-direction: row;
	user-select: none;
	cursor: pointer;
	border: none;
}

:host {
	display: inline-block;
	position: relative;
}

:host::before {
	opacity: 0;
	content: "copied!";
	display: block;
	position: absolute;
	top: -0.5em;
	right: -0.5em;
	background: #0a0c;
	padding: 0 0.5em;
	border-radius: 1em;
	pointer-events: none;
	z-index: 1;
}

:host(:not([copied]))::before {
	transition: opacity 500ms ease;
}

:host([copied])::before {
	opacity: 1;
}

.content {
	display: flex;
	justify-content: row;
}

.label::after {
	content: ":";
	margin-right: 0.2em;
}

.id {
	opacity: 0.75;
	max-width: var(--id-max-width, 6em);
	overflow: hidden;
	text-overflow: ellipsis;
}

.copy svg {
	width: 1em;
	height: 1em;
}

.copy {
	opacity: 0.4;
	transition: opacity 100ms linear;
}

.container:hover .copy {
	opacity: 0.9;
}

.container:active .copy {
	opacity: 1;
}

`,Uo=U`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg>`,zo=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r};let Bo=class extends To{constructor(){super(...arguments),this.copied=!1}async copy(){try{await navigator.clipboard.writeText(this.id);const e=document.activeElement;e&&e.blur(),this.copyTimeout&&clearTimeout(this.copyTimeout),this.copied=!0,this.copyTimeout=setTimeout((()=>{this.copied=!1,this.copyTimeout=void 0}),1e3)}catch(e){console.error("failed to copy")}}render(){return D`
			<button class=container @click=${this.copy}>
				<div class=id>${this.id}</div>
				<div class=copy>
					${Uo}
				</div>
			</button>
		`}};zo([K()],Bo.prototype,"id",void 0),zo([K({type:Boolean,reflect:!0})],Bo.prototype,"copied",void 0),Bo=zo([_o,Oo(Do)],Bo);var Ho=re`

svg, span {
	vertical-align: middle;
}

svg {
	width: 1.2em;
	height: 1.2em;
}

slot[name=loading] svg {
	animation:
		spin 10s linear infinite,
		fade 500ms ease infinite alternate;
}

slot[name=error] * {
	color: var(--loading-error-color, red);
}

@keyframes spin {
	from { transform: rotate(0deg); }
	to { transform: rotate(360deg); }
}

@keyframes fade {
	from { opacity: 1.0; }
	to { opacity: 0.5; }
}

`,Fo=U`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 20 20"><g fill="none"><path d="M10 7a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0v-4A.5.5 0 0 1 10 7z" fill="#626262"/><path d="M10 14.5a.75.75 0 1 0 0-1.5a.75.75 0 0 0 0 1.5z" fill="#626262"/><path d="M8.686 2.852a1.5 1.5 0 0 1 2.628 0l6.56 11.925A1.5 1.5 0 0 1 16.558 17H3.44a1.5 1.5 0 0 1-1.314-2.223L8.686 2.852zm1.752.482a.5.5 0 0 0-.876 0L3.003 15.26a.5.5 0 0 0 .438.741H16.56a.5.5 0 0 0 .438-.74L10.438 3.333z" fill="currentColor"/></g></svg>`,Vo=U`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-loader"><line x1="12" y1="2" x2="12" y2="6"></line><line x1="12" y1="18" x2="12" y2="22"></line><line x1="4.93" y1="4.93" x2="7.76" y2="7.76"></line><line x1="16.24" y1="16.24" x2="19.07" y2="19.07"></line><line x1="2" y1="12" x2="6" y2="12"></line><line x1="18" y1="12" x2="22" y2="12"></line><line x1="4.93" y1="19.07" x2="7.76" y2="16.24"></line><line x1="16.24" y1="7.76" x2="19.07" y2="4.93"></line></svg>`,Wo=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r};let Qo=class extends To{constructor(){super(...arguments),this.mode="none",this._op=Pi.none(),this.errorIcon=Fo,this.loadingIcon=Vo,this["loading-message"]="loading...",this["error-message"]="error"}get op(){return this._op}set op(e){const t=this._op;this._op=e,this.mode=Pi.mode(e),this.requestUpdate("op",t)}render(){return Pi.select(this.op,{none:()=>D`
				<slot name=none></slot>
			`,loading:()=>D`
				<slot name=loading>
					${this.loadingIcon}
					<span>${this["loading-message"]}</span>
				</slot>
			`,error:e=>D`
				<slot name=error>
					${this.errorIcon}
					<span>${e??this.fallbackErrorMessage}</span>
				</slot>
			`,ready:()=>D`
				<slot></slot>
			`})}};Wo([K({type:String,reflect:!0})],Qo.prototype,"mode",void 0),Wo([K({type:Object})],Qo.prototype,"op",null),Wo([K()],Qo.prototype,"errorIcon",void 0),Wo([K()],Qo.prototype,"loadingIcon",void 0),Wo([K({type:String})],Qo.prototype,"loading-message",void 0),Wo([K({type:String})],Qo.prototype,"error-message",void 0),Qo=Wo([Oo(Ho)],Qo);var Go=re`

:host {
	display: inline-block;
	width: var(--avatar-size, 3em);
	height: var(--avatar-size, 3em);
	border-radius: var(--avatar-border-radius, 0.3em);
	overflow: hidden;
	user-select: none;
}

.avatar {
	display: block;
	width: 100%;
	height: 100%;
	color: #444;
	background: #888;
}

.avatar[data-logged-in] {
	color: #fff;
}

svg, img {
	pointer-events: none;
	display: block;
	width: 100%;
	height: 100%;
	object-fit: cover;
}

`,Xo=U`<svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill="currentColor" fill-rule="evenodd" d="M12 14.002a.998.998 0 0 1-.998.998H1.001A1 1 0 0 1 0 13.999V13c0-2.633 4-4 4-4s.229-.409 0-1c-.841-.62-.944-1.59-1-4 .173-2.413 1.867-3 3-3s2.827.586 3 3c-.056 2.41-.159 3.38-1 4-.229.59 0 1 0 1s4 1.367 4 4v1.002z"/></svg>`;function Jo(e,t,i){return e<t?t:e>i?i:e}function Zo(e,t,i){return`hsl(${e%360}, ${Jo(t,0,100)}%, ${Jo(i,0,100)}%)`}var Yo=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r};let Ko=class extends Lo{renderBlankAvatar(e){return D`
			<div class=avatar>
				${Xo}
			</div>
		`}renderSimpleAvatar({value:e}){const{color1:t,color2:i,color3:o}=function(e){const t=Math.ceil(360*e),i=(t-30)%360,o=(t+30)%360;return{color1:Zo(t,100,90),color2:Zo(i,50,60),color3:Zo(o,50,40)}}(e);return D`
			<div class=avatar style=${`color: ${t}; background: linear-gradient(to bottom right, ${i}, ${o});`}>
				${Xo}
			</div>
		`}renderImageAvatar({link:e}){return D`
			<div class=avatar>
				<img src="${e}" alt=""/>
			</div>
		`}render(){const{spec:e={type:"blank"}}=this;switch(e.type){case"blank":return this.renderBlankAvatar(e);case"simple":return this.renderSimpleAvatar(e);case"image":return this.renderImageAvatar(e);default:return D`avatar missing`}}};Yo([K({type:Object})],Ko.prototype,"spec",void 0),Ko=Yo([Oo(Go)],Ko);var en=re`

:host {
	display: inline-block;
	--_padding: var(--xio-button-padding, 0.2em 0.5em);
	--_background: var(--xio-button-background, transparent);
	--_border: var(--xio-button-border, 1px solid);
	--_border-radius: var(--xio-button-border-radius, 0);
	--_opacity: var(--xio-button-opacity, 0.7);
	--_hover-opacity: var(--xio-button-hover-opacity, 1);
	--_hover-color: var(--xio-button-hover-color, inherit);
	--_hover-background: var(--xio-button-hover-background, var(--_background));
	--_disabled-opacity: var(--xio-button-disabled-opacity, 0.2);
	--_disabled-border-style: var(--xio-button--disabled-border-style, dashed);
}

button {
	cursor: pointer;
	font: inherit;
	color: inherit;
	padding: var(--_padding);
	font-weight: bold;
	background: var(--_background);
	border: var(--_border);
	border-radius: var(--_border-radius);
	opacity: var(--_opacity);
}

button:not([disabled]):hover,
button:not([disabled]):focus {
	opacity: var(--_hover-opacity);
	color: var(--_hover-color);
	background: var(--_hover-background);
}

button[disabled] {
	cursor: default;
	opacity: var(--_disabled-opacity);
	border-style: var(--_disabled-border-style);
}

`;class tn extends CustomEvent{constructor(e){super("press",{detail:e})}}var on=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r};let nn=class extends To{constructor(){super(...arguments),this.disabled=!1,this.handleClick=()=>{const e=new tn(this);this.onpress&&this.onpress(e),this.disabled||this.dispatchEvent(e),e.stopPropagation()}}focus(){this.shadowRoot.querySelector("button").focus()}render(){return D`
			<button
				part=button
				@click=${this.handleClick}
				?disabled=${this.disabled}>
					<slot></slot>
			</button>
		`}};on([K({type:Boolean,reflect:!0})],nn.prototype,"disabled",void 0),on([K({type:Function})],nn.prototype,"onpress",void 0),nn=on([_o,Oo(en)],nn);var sn=re`

.example {
	color: #f90;
}

`,rn=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r};let an=class extends To{render(){return D`
			<div class=example>
				<p>xio-example</p>
				<slot></slot>
			</div>
		`}};an=rn([Oo(sn)],an);var ln=re`

* {box-sizing: border-box;}

:host {
	display: inline-block;
	vertical-align: middle;
	color: white;
}

:host([disabled]) {
	opacity: 0.25;
}

button {
	display: inline-block;
	border: unset;
	color: unset;
	background: unset;
}

button {
	position: relative;
	width: 1.5em;
	height: 1.5em;
	background: #3338;
	box-shadow: inset 1px 2px 3px #000a;
	border-radius: 0.5em;
	border: 1px solid #fff4;
}

button[data-mode="ready"] {
	cursor: pointer;
}

button[data-mode="ready"]:hover,
button[data-mode="ready"]:focus {
	background: #5558;
	border: 1px solid #fff8;
}

button > span {
	display: inline-block;
}

button svg {
	width: 100%;
	height: 100%;
}

button .error {
	display: inline-block;
	position: absolute;
	top: 80%;
	left: 0;
	width: max-content;
	max-width: 16em;
	color: red;
	background: #200a;
	text-shadow: 1px 2px 3px #0008;
	text-align: left;
	padding: 0.2em 0.5em;
	border-radius: 0.5em;
	pointer-events: none;
}

button[data-mode="loading"] svg,
button[data-mode="error"] svg {
	padding: 10%;
}

button[data-mode="error"] svg {
	color: red;
	animation: fade 1s ease infinite alternate;
}

button[data-mode="loading"] svg {
	animation:
		spin 10s linear infinite,
		fade 500ms ease infinite alternate;
}

@keyframes spin {
	from { transform: rotate(0deg); }
	to { transform: rotate(360deg); }
}

@keyframes fade {
	from { opacity: 1.0; }
	to { opacity: 0.5; }
}

`;class cn extends CustomEvent{constructor(e){super("press",{detail:e})}}var dn=U`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-check"><polyline points="20 6 9 17 4 12"></polyline></svg>`,pn=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r};let un=class extends To{constructor(){super(...arguments),this.loading=Pi.none(),this["initially-checked"]=!1,this["error-message"]="error",this.disabled=!1,this.handleClick=()=>{if(!this.disabled){this.toggle();const e=document.activeElement;e&&e.blur()}}}init(){this.loading=Pi.ready(this["initially-checked"])}get checked(){return Pi.value(this.loading)}set checked(e){this.loading=Pi.ready(e)}async toggle(e=Pi.value(this.loading),t=!0){const i=!e,o=!this.disabled,n=Pi.isReady(this.loading);return o&&n?Pi.operation({setOp:e=>this.loading=e,errorReason:this["error-message"],promise:(async()=>{if(await(this.save??(async()=>{}))(i),t){const e=new cn(this);this.oncheck&&this.oncheck(e),this.dispatchEvent(e),e.stopPropagation()}return i})()}):i}render(){return D`
			<button
				data-mode="${Pi.mode(this.loading)}"
				?data-checked=${Pi.value(this.loading)}
				@click=${this.handleClick}>
					${Pi.select(this.loading,{none:()=>null,loading:()=>Vo,error:e=>D`${Fo}<div class=error>${e}</div>`,ready:e=>e?dn:null})}
			</button>
		`}};pn([K()],un.prototype,"loading",void 0),pn([K({type:Boolean})],un.prototype,"initially-checked",void 0),pn([K({type:String})],un.prototype,"error-message",void 0),pn([K({type:Boolean,reflect:!0})],un.prototype,"disabled",void 0),pn([K({type:Function})],un.prototype,"oncheck",void 0),pn([K({type:Function})],un.prototype,"save",void 0),un=pn([_o,Oo(ln)],un);var hn=re`

/* * { outline: 1px solid #f002; } */

:host {
	display: block;
	width: 100%;
	max-width: 48rem;
	--height: var(--xio-text-input-height, 5rem);
	--pad: var(--xio-text-input-pad, 0.2em);
	--font: var(--xio-text-input-font, inherit);
	--color: var(--xio-text-input-color, inherit);
	--label-font: var(--xio-text-input-label-font, inherit);
	--label-color: var(--xio-text-input-label-color, inherit);
	--problems-font: var(--xio-text-input-problems-font, inherit);
	--problems-color: var(--xio-text-input-problems-color);
	--background: var(--xio-text-input-background, transparent);
	--valid-color: var(--xio-text-input-valid-color, #00ff8c);
	--invalid-color: var(--xio-text-input-invalid-color, #ff6100);
	--border: var(--xio-text-input-border, 1px solid);
	--border-radius: var(--xio-text-input-border-radius, 0.3em);
}

:host([hidden]) {
	display: none;
}

label {
	font: var(--label-font);
	color: var(--label-color);
}

slot {
	display: block;
	padding: 0 var(--pad);
}

.flexy {
	display: flex;
	flex-direction: row;
	flex-wrap: wrap;
}

.flexy > * {
	flex: 0 0 auto;
}

:host([textarea]) .flexy {
	flex-direction: column;
}

.inputbox {
	display: block;
	/* max-width: var(--width); */
	position: relative;
	flex: 1 1 auto;
}

:host([textarea]) .inputbox {
	flex: 1 1 auto;
	/* max-width: unset; */
}

.inputbox svg {
	position: absolute;
	display: block;
	top: var(--pad);
	right: var(--pad);
	width: 1.2em;
	height: 1.2em;
	pointer-events: none;
}

.container[data-valid] .inputbox svg {
	color: var(--valid-color);
}

.container:not([data-valid]) .inputbox svg {
	color: var(--invalid-color);
}

#textinput {
	min-width: 1em;
	width: 100%;
	font: var(--font);
	padding: var(--pad);
	padding-right: calc(1em + calc(2 * var(--pad)));
	margin: 0;
	color: var(--color);
	background: var(--background);
	border: var(--border);
	border-radius: var(--border-radius);
	text-overflow: ellipsis;
}

textarea {
	min-height: var(--height);
}

.problems {
	display: flex;
	font: var(--problems-font);
	padding: 0 calc(2 * var(--pad));
	flex-direction: column;
	justify-content: flex-start;
	flex: 1 1 auto;
	/* min-width: 12rem; */
	list-style: none;
	color: var(--problems-color, var(--invalid-color));
}

.problems > li {
	margin-top: 0.2em;
}

`;function mn(e){return e}class fn extends CustomEvent{constructor(){super("enterpress",{bubbles:!0,composed:!0,detail:void 0})}}class gn extends CustomEvent{constructor(e){super("valuechange",{bubbles:!0,composed:!0,detail:{value:e}})}}var vn=U`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-check-circle"><path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><path d="M22 4L12 14.01l-3-3"/></svg>`,bn=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r};let yn=class extends To{constructor(){super(...arguments),this.initial="",this.readonly=!1,this.textarea=!1,this["hide-validation"]=!1,this["show-validation-when-empty"]=!1,this.disabled=!1,this.placeholder="",this.hidden=!1,this.parser=mn,this.problems=[],this.onvaluechange=()=>{},this.onenterpress=()=>{},this.draft="",this.lastDraft="",this.dispatchValueChange=()=>{const{draft:e,lastDraft:t}=this;e!==t&&this.dispatchEvent(new gn(this.value)),this.lastDraft=e},this.dispatchEnterPress=()=>{this.dispatchEvent(new fn)},this.updateFromRawInput=()=>{this.draft=this.input.value},this.handleInputKeyUp=e=>{this.updateFromRawInput(),this.textarea||"Enter"!==e.key?this.dispatchValueChange():this.dispatchEnterPress()},this.handleInputChange=()=>{this.updateFromRawInput(),this.dispatchValueChange()}}focus(){this.shadowRoot.querySelector("#textinput").focus()}get value(){const{draft:e}=this,t=(this.parser??mn)(e);return this.problems=this.validator?this.validator(t):[],0===this.problems.length?t:void 0}get text(){return this.draft}set text(e){const{input:t}=this;t?(this.input.value=e,this.updateFromRawInput()):this.initial=e}init(){this.draft=this.initial,this.addEventListener("valuechange",this.onvaluechange),this.addEventListener("enterpress",this.onenterpress)}render(){const{readonly:e,disabled:t,problems:i,draft:o,placeholder:n,textarea:s,validator:r,handleInputKeyUp:a,handleInputChange:l}=this,c=0===i.length,d=!this["hide-validation"]&&!e&&r&&(!!this["show-validation-when-empty"]||0!==o.length);return D`
			<div class=container ?data-valid=${c}>
				<label for=textinput part=label><slot></slot></label>
				<div class=flexy>
					<div class=inputbox part=inputbox>
						${d?d?c?vn:Fo:null:null}
						${s?D`
							<textarea
								id=textinput
								part=textinput
								.value="${o}"
								?disabled=${t}
								?readonly=${e}
								tabindex=${e?"-1":"0"}
								placeholder=${n}
								@keyup=${a}
								@change=${l}
							></textarea>
						`:D`
							<input
								id=textinput
								type=text
								part=textinput
								.value="${o}"
								?disabled=${t}
								?readonly=${e}
								tabindex=${e?"-1":"0"}
								placeholder=${n}
								@keyup=${a}
								@change=${l}
								/>
						`}
					</div>
					<ol class=problems part=problems>
						${d&&!c?i.map((e=>D`
								<li>${e}</li>
							`)):null}
					</ol>
				</div>
			</div>
		`}};bn([K({type:String,reflect:!0})],yn.prototype,"initial",void 0),bn([K({type:Boolean,reflect:!0})],yn.prototype,"readonly",void 0),bn([K({type:Boolean,reflect:!0})],yn.prototype,"textarea",void 0),bn([K({type:Boolean,reflect:!0})],yn.prototype,"hide-validation",void 0),bn([K({type:Boolean,reflect:!0})],yn.prototype,"show-validation-when-empty",void 0),bn([K({type:Boolean,reflect:!0})],yn.prototype,"disabled",void 0),bn([K({type:String,reflect:!0})],yn.prototype,"placeholder",void 0),bn([K({type:Boolean,reflect:!0})],yn.prototype,"hidden",void 0),bn([K({type:Function})],yn.prototype,"parser",void 0),bn([K({type:Function})],yn.prototype,"validator",void 0),bn([K({type:Object})],yn.prototype,"problems",void 0),bn([ee("#textinput")],yn.prototype,"input",void 0),bn([K({type:String})],yn.prototype,"draft",void 0),yn=bn([_o,Oo(hn)],yn);var wn=re`

:host {
	display: inline-block;
	--local-avatar-size: var(--avatar-size, 3em);
}

.container {
	display: flex;
	flex-direction: row;
	flex-wrap: wrap;
}

xio-avatar {
	flex: 0 0 auto;
	margin-right: 0.4em;
	--avatar-size: var(--local-avatar-size);
}

.box {
	display: flex;
	flex-direction: row;
	flex-wrap: wrap;
	flex: 1;
	flex-basis: 8em;
}

.textfields {
	flex: 1 1 auto;
	margin-right: 1em;
}

.detail {
	margin-top: 0.5em;
}

.buttonbar {
	margin-top: 0.5em;
}

.cardplate > * {
	display: block;
}

.tags {
	list-style: none;
	font-size: 0.6em;
	cursor: default;
}

.tags > li {
	display: inline-block;
	margin: 0 0.1em;
	padding: 0 0.25em;
	border: 1px solid;
	border-radius: 1em;
}

[data-tag=staff] {
	color: var(--cobalt-tagcolor-staff, lime);
}

[data-tag=banned] {
	color: var(--cobalt-tagcolor-banned, red);
}

p[data-field=tagline] {
	opacity: 0.7;
	font-size: 0.8em;
	font-style: italic;
}

xio-text-input > span {
	opacity: 0.4;
	font-size: 0.7rem;
}

xio-text-input + xio-text-input {
	margin-top: 0.1em;
}

.detail {
	font-size: 0.7em;
	list-style: none;
}

.detail > li {
	margin-top: 0.2em;
}

.detail > li > :first-child {
	font-weight: bold;
}

.detail code {
	font-size: 0.6em;
	padding: 0.2em;
	border-radius: 0.3em;
	word-break: break-all;
	background: #0002;
}

.roles {
	font-size: 0.6em;
	list-style: none;
	padding: 0;
	margin-top: 0.3rem;
}

.roles li {
	display: inline-block;
	border: 1px solid;
	border-radius: 1em;
	padding: 0.1em 0.3em;
	line-height: 0.8em;
}

`;function xn({field:e,text:t,input:i}){return i?D`
			<xio-text-input
				data-field="${e}"
				initial=${t}
				part="xiotextinput"
				exportparts="${"\n\t\t\t\t\tlabel: xiotextinput-label,\n\t\t\t\t\ttextinput: xiotextinput-textinput,\n\t\t\t\t\tproblems: xiotextinput-problems,\n\t\t\t\t"}"
				show-validation-when-empty
				?readonly=${i.readonly}
				?hide-validation=${!i.draftIsChanged}
				.validator=${i.validator}
				@valuechange=${i.onvaluechange}>
					<span>${i.label}</span>
			</xio-text-input>
		`:D`
			<p part="textfield" data-field="${e}">${t}</p>
		`}function kn(e){const t=new Date(e),i=e=>e.toString().padStart(2,"0"),o=i(t.getFullYear()),n=i(t.getMonth()+1),s=i(t.getDate()),r=t.getHours();let a=t.getHours();a%=12,a=a||12;const l=i(t.getMinutes()),c=r>=12?"pm":"am",d=-t.getTimezoneOffset(),p=(d/60).toFixed(d%60==0?0:1),u=0===d?"UTC":`UTC${d<0?"":"+"}${p}`,h=`${o}-${n}-${s}`,m=`${a}:${l} ${c}`,f=`${`${Intl.DateTimeFormat().resolvedOptions().timeZone} ${u}`}`;return{date:h,time:m,zone:f,full:`${h} ${m} (${f})`}}function Sn(e){return{tagline:e.tagline,nickname:e.nickname}}function In(e,t,i=null){return D`
		<xio-op .op=${e}>
			${function(e,t){return Pi.isReady(e)?t(Pi.value(e)):null}(e,t)}
			${i}
		</xio-op>
	`}var $n,Pn,An=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r},Rn=function(e,t,i,o){if("a"===i&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?o:"a"===i?o.call(e):o?o.value:t.get(e)};let _n=class extends To{constructor(){super(...arguments),$n.set(this,this.auto.state({busy:Pi.ready(void 0)})),Pn.set(this,this.auto.actions({setBusy:e=>{Rn(this,$n,"f").busy=e}})),this.profileDraft=void 0,this.problems=[],this.handleChange=Ai(200,(()=>{if(!this.user)return;const{profileDraft:e,isChanged:t}=this.generateNewProfileDraftFromInputs();this.profileDraft=t?e:void 0})),this.handleSave=async()=>{await Pi.operation({promise:this.saveProfile(this.profileDraft).finally((()=>{this.profileDraft=null})),setOp:e=>Rn(this,Pn,"f").setBusy(e)})}}init(){Rn(this,Pn,"f").setBusy(Pi.ready(void 0))}get draftIsChanged(){return!!this.profileDraft}get readonly(){return!this.saveProfile}getTextInputField(e){return function(e,t=document){return t.querySelector(e)}(`xio-text-input[data-field="${e}"]`,this.shadowRoot)}generateNewProfileDraftFromInputs(){const{profile:e}=this.user,t=Sn(e),i=this.getTextInputField("nickname");if(!i)return{profileDraft:t,isChanged:!1};const o=this.getTextInputField("tagline");t.nickname=i.value,t.tagline=o.value,this.problems=[...i.problems,...o.problems];return{profileDraft:t,isChanged:!Ci(Sn(e),t)}}render(){const{user:e,draftIsChanged:t}=this;if(!e)return null;const i=e.profile.avatar;return In(Rn(this,$n,"f").busy,(()=>D`
			<div class=container ?data-readonly=${this.readonly}>
				<xio-avatar .spec=${i}></xio-avatar>
				<div class=box>
					<div class=textfields>
						${xn({field:"nickname",text:e.profile.nickname,input:this.readonly?void 0:{label:"nickname",readonly:!1,draftIsChanged:t,validator:ui.nickname,onvaluechange:this.handleChange}})}
						${xn({field:"tagline",text:e.profile.tagline,input:this.readonly?void 0:{label:"tagline",readonly:!1,draftIsChanged:t,validator:ui.tagline,onvaluechange:this.handleChange}})}
						${function(e){return D`
		<ul class=roles>
			${e.roles.map((e=>D`
				<li
					data-role-label="${e.label}"
					data-role-id="${e.roleId}">
						${e.label}
				</li>
			`))}
		</ul>
	`}(e)}
						${this.readonly?null:D`
							<div class=buttonbar>
								<xio-button
									?disabled=${!this.profileDraft||this.problems.length>0}
									@press=${this.handleSave}>
										<slot name=save-button>save profile</slot>
								</xio-button>
							</div>
						`}
					</div>
					${this["show-details"]?function(e){return D`
		<ul class=detail>
			<li>
				<span>joined:</span>
				<span>${kn(e.stats.joined).date}</span>
			</li>
			<li>
				<span>user id:</span>
				<span><xio-id id="${e.userId}"></xio-id></span>
			</li>
		</ul>
	`}(e):null}
				</div>
			</div>
		`))}};$n=new WeakMap,Pn=new WeakMap,An([K({type:Boolean})],_n.prototype,"show-details",void 0),An([K({type:Object})],_n.prototype,"user",void 0),An([K({type:Object})],_n.prototype,"saveProfile",void 0),An([K({type:Object})],_n.prototype,"profileDraft",void 0),_n=An([Oo(wn)],_n);var qn=re`

.adminmanager .adminassigner {
	display: flex;
	flex-direction: row;
	margin: 0.5em 0;
}

.adminmanager .adminassigner > * {
	display: block;
}

.adminmanager .adminassigner > xio-text-input {
	flex: 1 1 auto;
}

.adminmanager .adminassigner > xio-text-input {
	width: 100%;
	max-width: 100%;
}

.adminmanager .adminassigner > xio-text-input::part(problems) {
	min-width: unset;
}

.adminmanager .adminassigner > xio-button {
	margin-top: 1.1em;
	margin-left: 0.3em;
}

.adminmanager .adminlist ul {
	list-style: none;
	padding: 0 1em;
	border: 1px solid #fff1;
}

.adminmanager .adminlist li {
	display: flex;
	flex-direction: row;
	align-content: center;
	padding: 0.3em 0;
	font-size: 0.8em;
}

.adminmanager .adminlist li + li {
	border-top: 1px solid #fff1;
}

.adminmanager .adminlist li > * {
	display: block;
}

.adminmanager .adminlist li > span {
	flex: 1 1 auto;
	display: flex;
	align-items: center;
	word-break: break-all;
}

.adminmanager .adminlist li > xio-button {
	color: #fff3;
}

`,Cn=re`

:host {
	display: block;
}

.app-list {
	margin-top: 2em;
	margin-bottom: 2em;
}

.app-list > xio-op {
	display: block;
	border: 1px solid #f00;
	margin-top: 0.5em;
	border: 1px solid #fff1;
	border-radius: 0.2em;
}

.app-list > xio-op[mode="loading"] {
	padding: 4em 2em;
}

.app > * + * {
	margin-top: 0.3em;
}

.app + .app {
	margin-top: 1.5em;
}

.app > * {
	padding: 0.4em 1rem;
}

.app-header {
	display: flex;
	flex-direction: row;
	flex-wrap: wrap;
	justify-content: flex-end;
	padding: 0;
	background: #0001;
}

.app-header .title {
	max-width: 100%;
	flex: 1 0 auto;
	padding: 0.3em 1em;
}

.app-header .title h3 {
	font-size: 1.5em;
	font-weight: bold;
}

.app-header .title h3::before {
	content: "🌐";
	color: white;
}

.app-header .stats {
	display: flex;
	flex-direction: row;
	justify-content: center;
	flex-wrap: wrap;
	padding: 0.2em;
}

.app-header .stats [data-stat] {
	display: flex;
	flex-direction: column;
	justify-content: flex-end;
	max-width: 6em;
	text-align: center;
}

.app-header .stats [data-stat] > span {
	padding: 0.1em 0.6em;
}

.app-header .stats [data-stat] > span:nth-child(1) {
	justify-self: flex-start;
}

.app-header .stats [data-stat] > span:nth-child(2) {
	opacity: 0.3;
	font-size: 0.6em;
}

.twoside {
	display: flex;
	flex-direction: row;
	flex-wrap: wrap;
}

.twoside > div {
	max-width: 100%;
	flex: 1 0 16em;
	padding-bottom: 1em;
}

.twoside > div:nth-child(1) {
	padding-right: 1rem;
}

.editside > .buttons {
	display: flex;
	justify-content: center;
	align-items: center;
}

.app-form > * + * {
	margin-top: 0.3em;
}

.app-form xio-button {
	margin-top: 0.6em;
}

.app-options {
	border: 1px solid #fff1;
	padding: 1em;
}

.app-options > * + * {
	margin-top: 3em;
}

code {
	display: inline-block;
	font-size: 0.8em;
	padding: 0.2em;
	border-radius: 0.3em;
	background: #0002;
	overflow-wrap: anywhere;
	word-break: break-all;
}

code.id {
	opacity: 0.7;
	font-size: 0.5em;
}

.codeblock {
	display: block;
}

.htmlcode { color: #fff6; }
.htmlcode [data-syntax=tag] { color: deepskyblue; }
.htmlcode [data-syntax=attr] { color: skyblue; }
.htmlcode [data-syntax=data] { color: #aaffa0; }
.htmlcode [data-syntax=indent] {
	display: block;
	margin-left: 1em;
}

.app-code > * {
	margin-top: 1em;
}

.app-code code {
	display: block;
	font-size: 0.6em;
	padding: 1em;
	margin: 0.5em 0;
}

.delete-app-button {
	display: block;
	text-align: right;
	--xio-button-hover-color: red;
}

${qn}

.app-list {
	margin-bottom: 5rem;
}

.app-registration {
	max-width: 40em;
	margin-bottom: 5em;
}

`;const Mn=e=>e.split("\n").map((e=>e.trim().toLowerCase())).filter((e=>e.length>0));function On({clearOnSubmit:e,submitButtonText:t,showAdditionalOrigins:i,initialValues:o={home:"",label:"",additionalOrigins:[]},query:n,submit:s,requestUpdate:r}){const a={problems:[],formDisabled:!1,draft:o,get valid(){return!this.formDisabled&&this.draft&&0===this.problems.length}};function l(){return{home:n('.app-form [data-form="home"]'),label:n('.app-form [data-form="label"]'),additionalOrigins:n('.app-form [data-form="additional-origins"]')}}const c=()=>{const{home:e,label:t,additionalOrigins:i}=l();var o;a.draft={home:e.value,label:t.value,additionalOrigins:i.value},a.problems=(o=a.draft,[...Nt.label(o.label),...Nt.home(o.home),...Nt.additionalOrigins(o.additionalOrigins)]),r()};function d(){a.problems=[],a.formDisabled||c()}async function p(){c(),a.formDisabled=!0,r();try{await s(a.draft),e?function(e){const t=l();t.home.text=e.home,t.label.text=e.label,t.additionalOrigins.text=e.additionalOrigins.join("\n")}(o={home:"",label:"",additionalOrigins:[]}):o=a.draft}finally{a.formDisabled=!1,r()}}return{render:function({partNamespace:e}){const{formDisabled:n,draft:s,problems:r}=a,l=!Ci(o,s),c=!l||n||r.length>0,u=`\n\t\t\tlabel: xiotextinput-label,\n\t\t\ttextinput: xiotextinput-textinput,\n\t\t\tproblems: xiotextinput-problems,\n\n\t\t\tlabel: ${e}-appform-xiotextinput-label,\n\t\t\ttextinput: ${e}-appform-xiotextinput-textinput,\n\t\t\tproblems: ${e}-appform-xiotextinput-problems,\n\t\t`,h=({hide:t,textarea:i,label:o,dataForm:s,initialText:r,showValidationWhenEmpty:a,parser:c,validator:p})=>D`
			<xio-text-input
				?textarea=${i}
				part="${e}-appform-xiotextinput"
				exportparts="${u}"
				data-form="${s}"
				initial="${r}"
				?hidden=${t}
				?disabled=${n}
				?hide-validation=${!l}
				?show-validation-when-empty=${a}
				.parser=${c}
				.validator=${p}
				@valuechange=${d}>
					<span part=xio-text-input-label>
						${o}
					</span>
			</xio-text-input>
		`;return D`
			<div class=app-form>
				<slot name=create-app-heading></slot>

				${h({hide:!1,textarea:!1,dataForm:"label",label:"community name",initialText:o.label,showValidationWhenEmpty:!1,parser:void 0,validator:Nt.label})}

				${h({hide:!1,textarea:!1,dataForm:"home",label:'website homepage, like "https://chasemoskal.com/"',initialText:o.home,showValidationWhenEmpty:!1,parser:void 0,validator:Nt.home})}

				${h({hide:!i,textarea:!0,dataForm:"additional-origins",label:"(optional) additional domain names",initialText:o.additionalOrigins.join("\n"),showValidationWhenEmpty:!0,parser:Mn,validator:Nt.additionalOrigins})}

				<xio-button
					class="create-app-button"
					?disabled=${c}
					@press=${p}>
						${t}
				</xio-button>
			</div>
		`}}}function Tn({app:e,manageAdminsService:t,query:i}){const{state:o,actions:n,track:s}=function(){const e=Ni(),t=e.state({admins:Pi.none(),assignerDraft:{email:void 0}}),i=e.actions({setAdmins(e){t.admins=e},setAssignerDraft(e){t.assignerDraft=e}});return{track:e.track,state:t,actions:i}}(),r=function({app:e,state:t,actions:i,manageAdminsService:o}){const{appId:n}=e,s=(e=Promise.resolve(void 0))=>Pi.operation({promise:e.then((()=>o.listAdmins({appId:n}))),setOp:e=>i.setAdmins(e)});return{listAdmins:async function(){await s()},assignAdmin:async function(){const{email:e}=t.assignerDraft;i.setAssignerDraft({email:void 0}),await s(o.assignAdmin({appId:n,email:e}))},revokeAdmin:async function(e){await s(o.revokeAdmin({appId:n,userId:e}))}}}({app:e,state:o,actions:n,manageAdminsService:t});function a(e){const t=e.detail.value??void 0;n.setAssignerDraft({email:t})}function l(){const e=i(".adminassigner xio-text-input");r.assignAdmin(),e.text=""}function c(){return D`
			<div class=adminassigner>
				<xio-text-input
					part=adminmanager-xiotextinput
					exportparts="${"\n\t\t\tlabel: xiotextinput-label,\n\t\t\ttextinput: xiotextinput-textinput,\n\t\t\tproblems: xiotextinput-problems,\n\n\t\t\tlabel: adminmanager-xiotextinput-label,\n\t\t\ttextinput: adminmanager-xiotextinput-textinput,\n\t\t\tproblems: adminmanager-xiotextinput-problems,\n\t\t"}"
					.validator=${xi}
					@valuechange=${a}>
						email
				</xio-text-input>
				<xio-button
					?disabled=${!o.assignerDraft.email}
					@press=${l}>
						grant
				</xio-button>
			</div>
		`}return{render:function(){return D`
			${c()}
			${D`
			<div class=adminlist>
				${In(o.admins,(e=>D`
					<ul>
						${e.map((({email:e,userId:t})=>D`
							<li>
								<span>${e}</span>
								<xio-button @press=${()=>r.revokeAdmin(t)}>
									revoke
								</xio-button>
							</li>
						`))}
					</ul>
				`))}
			</div>
		`}
		`},controls:r,track:s}}function En(e){return{home:e.home,label:e.label,origins:(t=[new URL(e.home).origin,...e.additionalOrigins],[...new Set(t)])};var t}var Ln=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r};let Nn=class extends No{constructor(){super(...arguments),this.appRegistrationForm=On({clearOnSubmit:!0,showAdditionalOrigins:!1,submitButtonText:"create community",requestUpdate:()=>this.requestUpdate(),query:e=>this.shadowRoot.querySelector(".app-registration").querySelector(e),submit:async e=>{const t=En(e);await this.share.appModel.registerApp(t)}}),this.getAppState=function(e){const t=new Map;return function(i){let o;return t.has(i)?o=t.get(i):(o=e(i),t.set(i,o)),o}}((e=>{const t=this.share.appModel.getApp(e),{actions:i,getState:o,onStateChange:n}=Mi({state:{editMode:!1},actions:e=>({toggleEditMode(){e.editMode=!e.editMode}})});return n((()=>{this.requestUpdate()})),{toggleEditMode:i.toggleEditMode,get editMode(){return o().editMode},appForm:On({clearOnSubmit:!1,showAdditionalOrigins:!0,submitButtonText:"save changes",initialValues:(s=t,{home:s.home,label:s.label,additionalOrigins:(r=s.home,a=s.origins,a.filter((e=>e.toLowerCase()!==new URL(r.toLowerCase()).origin)).map((e=>e.toLowerCase())))}),requestUpdate:()=>{this.requestUpdate()},query:e=>this.shadowRoot.querySelector(`.app[data-app-id="${t.appId}"] .app-options`).querySelector(e),submit:async e=>{const i=En(e);await this.share.appModel.updateApp(t.appId,i)}}),adminManager:(()=>{const e=Tn({app:t,manageAdminsService:this.share.appModel.manageAdminsService,query:e=>this.shadowRoot.querySelector(`.app[data-app-id="${t.appId}"] .adminmanager`).querySelector(e)});return e.track({watcher:()=>{e.render()},effect:()=>this.requestUpdate()}),e.controls.listAdmins(),e})()};var s,r,a})),this.deleteApp=async e=>{await this.share.modals.confirm({title:"are you certain?",body:`you really want to delete your community "${e.label}"?`,yes:{label:"delete whole community",vibe:"negative"},no:{label:"nevermind",vibe:"neutral"},focusNthElement:2})&&await this.share.appModel.deleteApp(e.appId)}}init(){this.share.appModel.loadApps()}renderAppRegistration(){return D`
			<div class=app-registration>
				<slot name="register-app-heading"></slot>
				${this.appRegistrationForm.render({partNamespace:"appregistration"})}
			</div>
		`}renderNoApps(){return D`
			<slot name=no-apps></slot>
			${this.renderAppRegistration()}
		`}renderAppList(e){return D`
			<slot></slot>
			<div class=app-list>
				${Object.entries(e).map((([e,t])=>In(t,(e=>this.renderApp(e)))))}
			</div>
			${this.renderAppRegistration()}
		`}renderAppBankLinking(e){return null}renderAppCode(e){return D`
			<div class=app-code>
				<h4>connect your website</h4>
				<p>copy-paste this html into your website's &lt;head&gt; section:</p>
				<code class=htmlcode>
					${function(e){const t=(e,t)=>D`<span data-syntax=${e}>${t}</span>`,i=e=>t("tag",e),o=e=>t("attr",e),n=e=>t("data",e),s=e=>t("glue",e),r=s('"');return D`
		${s("<")}${i("script")} ${o("async")} ${o("defer")} ${o("src")}${s("=")}${r}${n("https://unpkg.com/xiome/x/xiome.bundle.min.js")}${r}${s(">")}${s("</")}${i("script")}${s(">")}
		<br/>
		${s("<")}${i("xiome-config")} ${o("app")}${s("=")}${r}${n(e)}${r}${s(">")}${s("</")}${i("xiome-config")}${s(">")}
	`}(e)}
				</code>
				<p>then head over to the <a part=link href="./components">components page</a></p>
			</div>
		`}renderApp(e){const t=this.getAppState(e.appId);return D`
			<div class=app data-app-id=${e.appId}>

				<div class=app-header part=app-header>
					<div class=title>
						<h3>
							<a part=link target=_blank href="${e.home}">
								${e.label}
							</a>
						</h3>
					</div>
					<div class=stats>
						<div data-stat=users>
							<span>${e.stats.users.toLocaleString()}</span>
							<span>users</span>
						</div>
						<div data-stat=monthly-active>
							<span>${e.stats.usersActiveMonthly.toLocaleString()}</span>
							<span>monthly active</span>
						</div>
						<div data-stat=active-last-day>
							<span>${e.stats.usersActiveDaily.toLocaleString()}</span>
							<span>daily active</span>
						</div>
					</div>
				</div>

				<div class=twoside>
					${this.renderAppCode(e.appId)}
					<div class=editside>
						<div class=buttons>
							<xio-button @click=${t.toggleEditMode}>edit community</xio-button>
						</div>
						<div class=app-options ?hidden=${!t.editMode}>
							<div class=app-details>
								${t.appForm.render({partNamespace:"appeditor"})}
							</div>
							<div class=adminmanager>
								<h4>manage admins</h4>
								${t.adminManager.render()}
							</div>
							${this.renderAppBankLinking(e)}
							<div class=finalbox>
								<xio-button
									class=delete-app-button
									@press=${()=>this.deleteApp(e)}>
										delete community
								</xio-button>
							</div>
						</div>
					</div>
				</div>
			</div>
		`}render(){const{appRecords:e}=this.share.appModel.state;return D`
			${In(e,(e=>Object.values(e).length?this.renderAppList(e):this.renderNoApps()))}
		`}};Nn=Ln([Oo(Cn)],Nn);var jn=re`

.avatar {
	display: block;
	width: 3em;
	height: 3em;
	padding: 0.2em;
	border-radius: 0.3em;
	color: #333;
	background: #4448;
}

:host([logged-in]) .avatar {
	color: #fff;
}

svg {
	display: block;
	width: 100%;
	height: 100%;
}

`,Dn=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r};let Un=class extends Eo{render(){const e=Pi.value(this.share.authModel.access)?.user?.profile.avatar;return D`
			<xio-avatar .spec=${e} part="xio-avatar"></xio-avatar>
		`}};Un=Dn([Oo(jn)],Un);var zn=re`

xio-profile-card {
	--avatar-size: 7em;
}

`,Bn=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r};let Hn=class extends Eo{constructor(){super(...arguments),this.saveProfile=async e=>{this.share.personalModel.saveProfile(e)}}render(){return In(this.share.authModel.access,(({user:e})=>D`
			<xio-profile-card
				show-details
				.user=${e}
				.saveProfile=${this.saveProfile}
			></xio-profile-card>
		`))}};Hn=Bn([Oo(zn)],Hn);var Fn=re`

slot {
	display: block;
}

xio-text-input,
xio-button {
	margin-top: 0.2em;
}

xio-text-input > span {
	opacity: 0.4;
	font-size: 0.7em;
}

.buttonbar {
	margin-top: 0.5em;
	vertical-align: middle;
}

slot[name="legal"] {
	display: inline-block;
	margin: 0 1em;
}

small {
	display: block;
	opacity: 0.5;
	font-size: 0.7em;
}

`,Vn=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r};let Wn=class extends Eo{constructor(){super(...arguments),this["show-logout"]=!1,this.sentLoading=Pi.none(),this.emailIsValid=!1}async sendEmail(){const e=this.textInput.value;await Pi.operation({promise:this.share.authModel.sendLoginLink(e).then((()=>({email:e}))),setOp:e=>this.sentLoading=e,errorReason:`failed sending email to "${e}"`})}resetSentLoading(){this.sentLoading=Pi.none(),this.textInput&&(this.textInput.text="")}logout(){this.share.authModel.logout().then((()=>this.sentLoading=Pi.none()))}subscribe(){return this.share.authModel.onAccessChange((()=>{this.resetSentLoading()}))}renderLoggedIn(e){return D`
			<slot>
				<p>Welcome ${e.user.profile.nickname}!</p>
			</slot>
			${this["show-logout"]?D`
					<div part=buttonbar>
						<xio-button class=logout-button @press=${this.logout}>
							Logout
						</xio-button>
					</div>
				`:null}
		`}handleEmailChange(){this.emailIsValid=0===this.textInput.problems.length}renderLegalLink(){return D`
			<small>
				<p>
					<a
						part=link
						target=_blank
						href="https://xiome.io/legal">
							policies and terms
					</a>
				</p>
			</small>
		`}renderLoggedOut(){const{emailIsValid:e}=this;return D`
			<xio-op .op=${this.sentLoading}>
				<div slot=none>
					<slot name=logged-out>
						<p>login with your email address</p>
					</slot>
					<xio-text-input
						.validator=${Et()}
						@valuechange=${this.handleEmailChange}
						@enterpress=${this.sendEmail}>
							<span>your email</span>
					</xio-text-input>
					<div class=buttonbar>
						<slot name=legal>
							${this.renderLegalLink()}
						</slot>
						<xio-button
							?disabled=${!e}
							@press=${this.sendEmail}>
								send login link
						</xio-button>
					</div>
				</div>
				${Pi.isReady(this.sentLoading)?D`
						<p>email sent to ${Pi.value(this.sentLoading).email}</p>
						<xio-button @press=${this.resetSentLoading}>
							try another address?
						</xio-button>
					`:null}
			</xio-op>
		`}render(){const{access:e}=this.share.authModel;return In(e,(e=>e?.user?this.renderLoggedIn(e):this.renderLoggedOut()))}};Vn([K({type:Boolean,reflect:!0})],Wn.prototype,"show-logout",void 0),Vn([K()],Wn.prototype,"sentLoading",void 0),Vn([ee("xio-text-input")],Wn.prototype,"textInput",void 0),Vn([K({type:String})],Wn.prototype,"emailIsValid",void 0),Wn=Vn([Oo(Fn)],Wn);var Qn=re`

* {
	ZZoutline: 1px solid #0f02;
}

:host {
	display: block;
	width: 100%;
}

.container {
	display: flex;
	flex-direction: row;
	flex-wrap: wrap;
	gap: 0.5em;
}

.container > * {
	flex: 3 1 10em;
	display: flex;
	flex-direction: column;
}

.roles {
	flex: 1 3 10em;
}

.roles xio-button[data-hard] {
	opacity: 0.6;
}

.container > * > p {
	padding: 0 0.5em;
}

[part=plate] {
	flex: 1 1 auto;
	padding: 0.5em;
	background: #fff2;
}

[part=plate] xio-button {
	display: inline-block;
	margin: 0.2em 0.1em;
	--xio-button-disabled-opacity: 0.6;
}

[part=plate] xio-button[data-soft] {
	color: red;
}

[part=plate] xio-button[data-selected]::part(button) {
	border: 1px solid lime;
	background: yellow;
	color: black;
}

[part=plate] xio-button > div {
	display: flex;
	flex-direction: row;
}

[part=plate] xio-button .icon {
	margin-right: 0.2em;
}

[part=plate] xio-button svg {
	width: 0.8em;
	height: 0.8em;
}

.buttonbar {
	text-align: right;
	background: #0002;
}

.buttonbar [data-button=delete] {
	--xio-button-hover-color: red;
	--xio-button-hover-background: transparent;
}

.buttonbar [data-button=new] {
	--xio-button-hover-color: lime;
	--xio-button-hover-background: transparent;
}

`,Gn=U`<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-lock"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>`,Xn=U`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 16 16"><g fill="none"><path d="M7 5a4 4 0 0 1 5.445-3.73a.5.5 0 0 1 .173.819L10.708 4L12 5.293l1.91-1.91a.5.5 0 0 1 .82.172a4 4 0 0 1-4.829 5.292L4.897 13.92a1.986 1.986 0 0 1-2.843-2.774l5.051-5.234A4.01 4.01 0 0 1 7 5zm4-3a3 3 0 0 0-2.862 3.903a.5.5 0 0 1-.117.498L2.773 11.84a.986.986 0 0 0 1.41 1.377l5.225-5.293a.5.5 0 0 1 .532-.116a3 3 0 0 0 4.046-3.088l-1.633 1.634a.5.5 0 0 1-.707 0l-2-2a.5.5 0 0 1 0-.707l1.634-1.634A3.045 3.045 0 0 0 11 2z" fill="currentColor"/></g></svg>`,Jn=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r};let Zn=class extends No{constructor(){super(...arguments),this.clickRole=e=>()=>{this.roleSelected=e},this.clickDeleteRole=async()=>{const{modals:e,permissionsModel:t}=this.share,i=this.roleSelected;await e.confirm({title:"Delete role?",body:`Are you sure you want to permanently delete the role "${i.label}"`,yes:{vibe:"negative",label:"Delete role"},no:{vibe:"neutral",label:"Nevermind"},focusNthElement:2})&&await t.deleteRole({roleId:i.roleId})},this.clickNewRole=async()=>{const{modals:e,permissionsModel:t}=this.share,i=await e.prompt({title:"Create a new role",input:{label:"Role name",validator:vi},yes:{vibe:"positive",label:"Create role"}});i&&await t.createRole({label:i.value})},this.clickAvailablePrivilege=e=>async()=>{const{roleSelected:t}=this;t&&await this.share.permissionsModel.assignPrivilege({privilegeId:e,roleId:t.roleId})},this.clickAssignedPrivilege=e=>async()=>{const{roleSelected:t}=this;t&&await this.share.permissionsModel.unassignPrivilege({privilegeId:e,roleId:t.roleId})}}init(){this.share.permissionsModel.initialize()}getAssignedPrivileges(e){const{roleSelected:t}=this;if(!t)return[];const i=e.rolesHavePrivileges.filter((({roleId:e})=>e===t.roleId)).map((({privilegeId:e})=>e));return e.privileges.filter((({privilegeId:e})=>i.includes(e))).map((i=>{const{active:o,immutable:n}=e.rolesHavePrivileges.find((e=>e.roleId===t.roleId&&e.privilegeId===i.privilegeId));return{...i,active:o,immutable:n}}))}renderPrivilege({privilegeId:e,label:t,hard:i,immutable:o,onPrivilegeClick:n}){return D`
			<xio-button
				title="${e}"
				?disabled=${o}
				?data-hard=${i}
				?data-soft=${!i}
				?data-immutable=${o}
				@press=${n}>
					<div>
						${o?D`<div class=icon>${Gn}</div>`:null}
						${t}
					</div>
			</xio-button>
		`}renderPermissions(e){const t=this.getAssignedPrivileges(e),i=t.filter((e=>e.active)),o=this.roleSelected?[...e.privileges.filter((e=>!t.find((t=>t.privilegeId===e.privilegeId)))).map((e=>({...e,immutable:!1}))),...t.filter((e=>!e.active))]:[];return D`
			<div class=container>
				<div class=roles>
					<p>roles</p>
					<div part=plate>
						${e.roles.map((e=>D`
							<xio-button
								title="${e.roleId}"
								?data-selected=${this.roleSelected&&e.roleId===this.roleSelected.roleId}
								?data-hard=${e.hard}
								?disabled=${this.roleSelected&&e.roleId===this.roleSelected.roleId}
								@click=${this.clickRole(e)}>
								<div>
									${e.hard?D`<div class=icon>${Xn}</div>`:null}
									${e.label}
								</div>
							</xio-button>
						`))}
					</div>
					<div part=plate class=buttonbar>
						${this.roleSelected?D`
								<xio-button
									data-button=delete
									?disabled=${this.roleSelected.hard}
									@press=${this.clickDeleteRole}>
										delete role
								</xio-button>
							`:null}
						<xio-button data-button=new @press=${this.clickNewRole}>
							new role
						</xio-button>
					</div>
				</div>

				<div class=assigned>
					<p>
						privileges assigned
						${this.roleSelected?` to "${this.roleSelected.label}"`:null}
					</p>
					<div part=plate>
						${i.map((e=>this.renderPrivilege({...e,onPrivilegeClick:this.clickAssignedPrivilege(e.privilegeId)})))}
					</div>
				</div>

				<div class=available>
					<p>privileges available</p>
					<div part=plate>
						${o.map((e=>this.renderPrivilege({...e,onPrivilegeClick:this.clickAvailablePrivilege(e.privilegeId)})))}
					</div>
				</div>
			</div>
		`}render(){const{permissionsModel:e}=this.share,{getUserCanCustomizePermissions:t,getState:i}=e,o=i();return t()?In(o.permissionsDisplay,this.renderPermissions.bind(this)):D`
				<p>you are not privileged to customize permissions</p>
			`}};Jn([K()],Zn.prototype,"roleSelected",void 0),Zn=Jn([Oo(Qn)],Zn);var Yn=function(e,t,i,o,n){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?n.call(e,i):n?n.value=i:t.set(e,i),i},Kn=function(e,t,i,o){if("a"===i&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?o:"a"===i?o.call(e):o?o.value:t.get(e)};function es(...e){return function(t){var i,o;return o=class extends t{constructor(){super(...arguments),i.set(this,[])}connectedCallback(){super.connectedCallback();const t=()=>{this.requestUpdate()};Yn(this,i,e.map((e=>e(t))),"f")}disconnectedCallback(){super.disconnectedCallback();for(const e of Kn(this,i,"f"))e();Yn(this,i,[],"f")}},i=new WeakMap,o}}function ts({models:e,modals:t}){const{authModel:i,appModel:o,personalModel:n,permissionsModel:s}=e;return{XiomeMyAvatar:Ro(i.track)(qo({authModel:i})(Un)),XiomeLoginPanel:Ro(i.track)(qo({authModel:i})(Wn)),XiomeAppManager:es(o.onStateChange)(qo({modals:t,appModel:o})(Nn)),XiomeMyAccount:Ro(i.track)(qo({authModel:i,personalModel:n})(Hn)),XiomePermissions:es(s.onStateChange)(qo({modals:t,authModel:i,permissionsModel:s})(Zn))}}var is=re`

/* * {
	outline: 1px solid #f002;
} */

:host {
	display: block;
	max-width: 36em;
	--bg: var(--xiome-questions-body-background, #0006);
	--color: var(--xiome-questions-body-color, #fff6);
	--like-color: var(--xiome-questions-like-color, cyan);
	--report-color: var(--xiome-questions-report-color, #f90);
}

.questions-moderation-panel {
	padding: 1em;
	border: 1px dotted;
	margin-bottom: 1em;
}

.questions-moderation-panel .purge-button {
	--xio-button-hover-color: red;
}

slot[name="empty"] {
	display: block;
	margin-top: 1em;
}

.questionslist {
	list-style: none;
}

.questionslist > li {
	margin-top: 2em;
}

.question-expression {
	display: flex;
	flex-direction: row;
}

.question-area {
	flex: 1 1 auto;
}

.question-voting {
	padding: 0.5em;
	padding-top: 4.5em;
}

.question-voting button {
	display: block;
	border: none;
	font: inherit;
	background: transparent;
	color: inherit;
}

.question-voting [data-vote] {
	cursor: pointer;
	opacity: 0.6;
	user-select: none;
}

.question-voting [data-vote="report"] {
	opacity: 0.4;
}

.question-voting [data-vote]:hover,
.question-voting [data-vote]:focus {
	opacity: 1;
}

.question-voting [data-vote="like"][data-active] {
	color: var(--like-color);
}

.question-voting [data-vote="report"][data-active] {
	color: var(--report-color);
}

.question-voting [data-vote] > span {
	vertical-align: middle;
}

.question-voting [data-vote] > span:nth-child(2) {
	font-size: 0.9em;
}

.question-voting svg {
	width: 1.4em;
	height: 1.4em;
	position: relative;
	top: 0.1em;
}

.question-editor {
	padding: 1em;
	border: 2px dashed;
}

.editor-intro {
	font-size: 1.2em;
	font-weight: bold;
	margin-bottom: 0.5em;
}

.editor-profile {
	margin: 0.5em 0;
}

xio-profile-card {
	width: 100%;
}

.editor-buttons {
	text-align: right;
}

.question-body {
	display: flex;
	flex-direction: column;
}

.question-controls {
	opacity: 0.6;
	font-size: 0.8em;
	padding-top: 0.4em;
	text-align: right;
}

.metabar {
	position: relative;
	padding-left: 3.5em;
	text-align: right;
}

.metabar::before {
	display: block;
	z-index: 0;
	content: "";
	position: absolute;
	width: 0;
	height: 0;
	left: 0.5em;
	bottom: 0;
	border: 1em solid transparent;
	border-bottom-color: var(--bg);
	margin-right: auto;
}

.metabar p {
	opacity: 0.5;
	font-size: 0.8em;
}

.textbox p,
.textbox xio-text-input {
	display: block;
	font: inherit;
	width: 100%;
	max-width: 100%;
	border: none;
	padding: 1em;
	background: var(--bg);
	color: var(--color);
	border-radius: 0.5em;
}

.textbox p {
	min-height: 4em;
	white-space: pre;
}

.textbox xio-text-input {
	--height: 8em;
	--border: none;
}

[data-editable] .metabar {
	order: 1;
}

[data-editable] .metabar::before {
	bottom: unset;
	top: 0;
	border-bottom-color: transparent;
	border-top-color: var(--bg);
}

`;function os({content:e,editable:t,timePosted:i,handleValueChange:o=(()=>{})}){const{date:n,time:s}=kn(i);return D`
		<div class=question-body ?data-editable=${t}>
			<div class=metabar>
				<p>
					${`${n} ${s}`}
				</p>
			</div>
			<div class=textbox>
				${t?D`
						<xio-text-input
							textarea
							.validator=${Xi}
							@valuechange=${o}
						></xio-text-input>
					`:D`
						<p>${e}</p>
					`}
			</div>
		</div>
	`}var ns=U`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M6.736 4C4.657 4 2.5 5.88 2.5 8.514c0 3.107 2.324 5.96 4.861 8.12a29.66 29.66 0 0 0 4.566 3.175l.073.041l.073-.04c.271-.153.661-.38 1.13-.674c.94-.588 2.19-1.441 3.436-2.502c2.537-2.16 4.861-5.013 4.861-8.12C21.5 5.88 19.343 4 17.264 4c-2.106 0-3.801 1.389-4.553 3.643a.75.75 0 0 1-1.422 0C10.537 5.389 8.841 4 6.736 4zM12 20.703l.343.667a.75.75 0 0 1-.686 0l.343-.667zM1 8.513C1 5.053 3.829 2.5 6.736 2.5C9.03 2.5 10.881 3.726 12 5.605C13.12 3.726 14.97 2.5 17.264 2.5C20.17 2.5 23 5.052 23 8.514c0 3.818-2.801 7.06-5.389 9.262a31.146 31.146 0 0 1-5.233 3.576l-.025.013l-.007.003l-.002.001l-.344-.666l-.343.667l-.003-.002l-.007-.003l-.025-.013A29.308 29.308 0 0 1 10 20.408a31.147 31.147 0 0 1-3.611-2.632C3.8 15.573 1 12.332 1 8.514z" fill="currentColor"/></svg>`,ss=U`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M14 20.408c-.492.308-.903.546-1.192.709c-.153.086-.308.17-.463.252h-.002a.75.75 0 0 1-.686 0a16.709 16.709 0 0 1-.465-.252a31.147 31.147 0 0 1-4.803-3.34C3.8 15.572 1 12.331 1 8.513C1 5.052 3.829 2.5 6.736 2.5C9.03 2.5 10.881 3.726 12 5.605C13.12 3.726 14.97 2.5 17.264 2.5C20.17 2.5 23 5.052 23 8.514c0 3.818-2.801 7.06-5.389 9.262A31.146 31.146 0 0 1 14 20.408z" fill="currentColor"/></svg>`,rs=U`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 20 20"><g fill="none"><path d="M8.686 2.852L2.127 14.777A1.5 1.5 0 0 0 3.441 17H16.56a1.5 1.5 0 0 0 1.314-2.223L11.314 2.852a1.5 1.5 0 0 0-2.628 0zM10 6.75a.75.75 0 0 1 .75.75v4a.75.75 0 0 1-1.5 0v-4a.75.75 0 0 1 .75-.75zm.75 7a.75.75 0 1 1-1.5 0a.75.75 0 0 1 1.5 0z" fill="currentColor"/></g></svg>`;var as,ls=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r},cs=function(e,t,i,o){if("a"===i&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?o:"a"===i?o.call(e):o?o.value:t.get(e)},ds=function(e,t,i,o,n){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?n.call(e,i):n?n.value=i:t.set(e,i),i};let ps=class extends Eo{constructor(){super(...arguments),as.set(this,void 0),this.board="default",this.draftText="",this.handlePost=async e=>{const t=this.draftText;this.editorTextInput.text="",await cs(this,as,"f").postQuestion({content:t,board:cs(this,as,"f").getBoardName()})},this.handleValueChange=e=>{this.draftText=e.detail.value}}get postable(){return!!this.draftText}init(){ds(this,as,this.share.questionsModel.makeBoardModel(this.board),"f"),cs(this,as,"f").loadQuestions()}renderQuestionsModerationPanel(){const e=cs(this,as,"f").getPermissions(),t=cs(this,as,"f").getBoardName();return e["moderate questions"]?D`
				<div class=questions-moderation-panel>
					<h3>moderate questions board "${this.board}"</h3>
					<xio-button
						class=purge-button
						@press=${async()=>{await this.share.modals.confirm({title:"Purge questions?",body:`Are you sure you want to delete all the questions on the board "${t}"? This cannot be undone.`,yes:{vibe:"negative",label:"Purge all"},no:{vibe:"neutral",label:"Nevermind"},focusNthElement:2})&&await cs(this,as,"f").archiveBoard()}}>
							Purge all questions
					</xio-button>
				</div>
			`:null}renderQuestionsEditor(){const e=cs(this,as,"f").getAccess(),t=cs(this,as,"f").getPermissions(),i=e?.user;return t["post questions"]?In(cs(this,as,"f").getPostingOp(),(()=>function({content:e,postable:t,questionAuthor:i,handlePost:o,handleValueChange:n}){return D`
		<div class=question-editor>
			<div class=editor-intro>
				<p class=editor-heading>Post a new question</p>
			</div>
			<div class=editor-textbox>
				${os({content:e,editable:!0,timePosted:Date.now(),handleValueChange:n})}
			</div>
			<div class=editor-profile>
				<xio-profile-card .user=${i} show-details></xio-profile-card>
			</div>
			<div class=editor-buttons>
				<xio-button
					?disabled=${!t}
					@press=${o}
				>Post question</xio-button>
			</div>
		</div>
	`}({questionAuthor:i,content:this.draftText,postable:this.postable,handlePost:this.handlePost,handleValueChange:this.handleValueChange}))):null}renderQuestionsList(){const e=cs(this,as,"f").getAccess(),t=e?.user?.userId,i=function(e,t){const i=[],o=[];for(const n of e)t&&n.authorUserId===t?i.push(n):o.push(n);const n=(e,t)=>{const i=-1,o=1;return e.likes>t.likes?i:e.likes<t.likes?o:e.reports<t.reports?i:e.reports>t.reports?o:e.timePosted>t.timePosted?i:e.timePosted<t.timePosted?o:0};return[...i.sort(n),...o.sort(n)]}(cs(this,as,"f").getQuestions(),t),o=cs(this,as,"f").getPermissions();return D`
			<ol class=questionslist>
				${i.map((t=>{const{questionId:i,authorUserId:n}=t,s=cs(this,as,"f").getUser(n),r=!(!e||!e.user)&&e.user.userId===s.userId;return function({author:e,authority:t,question:i,handleDelete:o,handleLike:n,handleReport:s}){const r=i.liked?{icon:ss,title:"unlike this post",click:()=>n(!1)}:{icon:ns,title:"like this post",click:()=>n(!0)},a=i.reported?{icon:rs,title:"unreport this post",click:()=>s(!1)}:{icon:Fo,title:"report this post",click:()=>s(!0)};return D`
		<li data-question-id="${i.questionId}">
			<div class=question-expression>
				<div class=question-voting>
					<button
						data-vote=like
						?data-active=${i.liked}
						tabindex=0
						title="${r.title}"
						@click=${r.click}>
							<span>${r.icon}</span>
							<span>${i.likes}</span>
					</button>
					<button
						data-vote=report
						?data-active=${i.reported}
						tabindex=0
						title="${a.title}"
						@click=${a.click}>
							<span>${a.icon}</span>
							<span>${i.reports}</span>
					</button>
				</div>
				<div class=question-area>
					<xio-profile-card .user=${e} show-details></xio-profile-card>
					${os({editable:!1,content:i.content,timePosted:i.timePosted})}
				</div>
			</div>
			<div class=question-controls>
				${t?D`<xio-button @press=${o}>delete</xio-button>`:null}
			</div>
		</li>
	`}({author:s,authority:o["moderate questions"]||r,question:t,handleDelete:async()=>{await this.share.modals.confirm({title:"Delete question?",body:"Are you sure you want to delete this question? This cannot be undone.",yes:{vibe:"negative",label:"Delete question"},no:{vibe:"neutral",label:"Nevermind"},focusNthElement:2})&&await cs(this,as,"f").archiveQuestion(i,!0)},handleLike:e=>{cs(this,as,"f").likeQuestion(i,e)},handleReport:async e=>{(!e||await this.share.modals.confirm({title:"Report question?",body:"Are you sure you want to submit a report against this question?",yes:{vibe:"negative",label:"Submit report"},no:{vibe:"neutral",label:"Nevermind"},focusNthElement:2}))&&await cs(this,as,"f").reportQuestion(i,e)}})}))}
			</ol>
		`}renderQuestionsBoard(){const e=cs(this,as,"f").getBoardOp(),t=cs(this,as,"f").getQuestions().length;return In(e,(()=>D`
			${this.renderQuestionsModerationPanel()}
			${this.renderQuestionsEditor()}
			${t>0?this.renderQuestionsList():D`<slot name=empty><p>Be the first to post a question!</p></slot>`}
		`))}render(){return cs(this,as,"f")&&cs(this,as,"f").getBoardOp()?this.renderQuestionsBoard():null}};function us({models:e,modals:t}){const{questionsModel:i}=e;return{XiomeQuestions:es(i.onStateChange)(qo({modals:t,questionsModel:i})(ps))}}as=new WeakMap,ls([K({type:String,reflect:!0})],ps.prototype,"board",void 0),ls([K({type:String})],ps.prototype,"draftText",void 0),ls([ee(".question-editor .question-body xio-text-input")],ps.prototype,"editorTextInput",void 0),ps=ls([Oo(is)],ps);var hs=re`

.container {
	display: block;
	width: 100%;
	max-width: 36em;
	padding: 0.5em !important;
	border: 1px solid;
}

.results {
	margin-top: 0.5em;
}

.userlist {
	list-style: none;
}

.userlist > li {
	display: flex;
	flex-direction: column;
	flex-wrap: wrap;
	background: #0002;
	padding: 0.5em;
	margin-top: 0.5em;
}

.userinfo {
	display: flex;
	flex-direction: row;
}

.userinfo xio-profile-card {
	flex: 1 1 auto;
}

.userinfo .controls {
	margin-left: 1em;
}

.userinfo .controls .edit[data-edit-mode] {
	color: lime;
	--xio-button-hover-color: lime;
}

.editwidget > div {
	margin-top: 1em;
}

.editwidget header + * {
	margin-top: 0.25em;
}

.editwidget header small {
	font-size: inherit;
	opacity: 0.6;
}

.editwidget ul {
	list-style: none;
}

.editwidget .allprivileges li {
	display: inline-block;
	font-size: 0.75em;
	padding: 0.1em 0.3em;
	margin: 0.2em 0.1em;
	border: 1px solid;
	border-radius: 1em;
}

`;function ms(e){return[...e.filter((e=>e.assignable)),...e.filter((e=>!e.assignable))]}function fs(e,t){return D`
		<xio-button
			?disabled=${!e.assignable}
			title=${e.roleId}
			data-role-id=${e.roleId}
			@press=${()=>t(e)}>
				${e.label}
		</xio-button>
	`}function gs(e){return D`
		<li
			title="${e.privilegeId}"
			data-privilege-id="${e.privilegeId}">
				${e.label}
		</li>
	`}var vs=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r};let bs=class extends No{constructor(){super(...arguments),this.userResults=Pi.ready([]),this.updateLocalUserResultsCache={assignRole:(e,t)=>{if(!Pi.ready(this.userResults))throw new Error("error updating user cache");const i=Pi.value(this.userResults);this.userResults=Pi.ready(i.map((i=>i.user.userId===e?{user:i.user,roleIds:[...i.roleIds,t]}:i)))},revokeRole:(e,t)=>{if(!Pi.ready(this.userResults))throw new Error("error updating user cache");const i=Pi.value(this.userResults);this.userResults=Pi.ready(i.map((i=>i.user.userId===e?{user:i.user,roleIds:i.roleIds.filter((e=>e!==t))}:i)))}},this.userStates=function({getUserResultsOp:e,rerender:t}){const i=new Map;return{cleanupObsoleteStates:function(){const t=[],o=e();if(Pi.ready(o)){const e=Pi.value(o);for(const o of i.keys())!e.find((({user:e})=>e.userId===o))&&t.push(o)}for(const e of t)i.delete(e)},obtainStateForUser:function(e){let o=i.get(e);if(!o){const n={editMode:!1,toggleEditMode(){n.editMode=!n.editMode,t()}};o=n,i.set(e,o)}return o}}}({getUserResultsOp:()=>this.userResults,rerender:()=>this.requestUpdate()}),this.searchText="",this.debouncedSearchUsers=function(e,t){let i,o,n,s,r;function a(){i=void 0,o=void 0,n=new Promise(((e,t)=>{s=e,r=t}))}return a(),(...l)=>{if(i=l,!o){const n=()=>{o=void 0,Promise.resolve(t(...i)).then((e=>{o||s(e)})).catch((e=>{o||r(e)})).finally((()=>{o||a()}))};o=setTimeout(n,e)}return n}}(1e3,(async e=>e?await this.share.administrativeModel.searchUsers({term:e}):[])),this.searchChange=async e=>(this.searchText=e.detail.value??"",this.search())}init(){this.share.administrativeModel.initialize()}async search(){const{searchText:e}=this;this.userResults=Pi.ready([]),e?await Pi.operation({promise:this.debouncedSearchUsers(e),setOp:e=>this.userResults=e}):this.userResults=Pi.ready([]),this.userStates.cleanupObsoleteStates()}render(){const{permissionsOp:e}=this.share.administrativeModel.getState(),t=this.share.administrativeModel.isAllowed("administrate user roles"),i=t=>{const{user:i}=t,o=this.userStates.obtainStateForUser(i.userId);return D`
				<li>
					<div class=userinfo>
						<xio-profile-card
							.user=${i}
							show-details
						></xio-profile-card>
						<div class=controls>
							<xio-button
								class=edit
								?data-edit-mode=${o.editMode}
								@press=${o.toggleEditMode}>
									${Xn}
							</xio-button>
						</div>
					</div>
					${o.editMode?In(e,(e=>function({permissions:e,administrativeModel:t,updateLocalUserResultsCache:i,userResult:{user:{userId:o},roleIds:n},blur:s,search:r}){const a=ms(n.map((t=>e.roles.find((e=>e.roleId===t)))).filter((e=>!!e))),l=ms(e.roles.filter((e=>!n.includes(e.roleId))).filter((e=>!!e))),c=e.privileges.filter((t=>e.rolesHavePrivileges.filter((e=>e.active&&e.privilegeId===t.privilegeId)).filter((e=>n.includes(e.roleId))).length>0));async function d(){o===t.getState().access?.user?.userId&&await t.reauthorize()}async function p({roleId:e}){await t.assignRoleToUser({userId:o,roleId:e,isPublic:!0,timeframeEnd:void 0,timeframeStart:void 0}),i.assignRole(o,e),s(),await d(),await r()}async function u({roleId:e}){await t.revokeRoleFromUser({userId:o,roleId:e}),i.revokeRole(o,e),s(),await d(),await r()}return D`
		<div class=editwidget>
			<div class=available>
				<header>roles available <small>(click to assign)</small></header>
				<div>
					${l.map((e=>fs(e,p)))}
				</div>
			</div>
			<div class=assigned>
				<header>roles assigned <small>(click to revoke)</small></header>
				<div>
					${a.map((e=>fs(e,u)))}
				</div>
			</div>
			<div class=allprivileges>
				<header>user has these privileges</header>
				<ul>
					${c.map(gs)}
				</ul>
			</div>
		</div>
	`}({userResult:t,permissions:e,administrativeModel:this.share.administrativeModel,updateLocalUserResultsCache:this.updateLocalUserResultsCache,blur:()=>{const e=document.activeElement;e&&e.blur()},search:()=>this.search()}))):null}
				</li>
			`};return D`
			<div class=container>

				${t?D`
					<xio-text-input
						.text=${this.searchText}
						placeholder="search for users"
						.validator=${mo}
						@valuechange=${this.searchChange}
					></xio-text-input>

					<div class=results>
						${In(this.userResults,(e=>e.length>0?D`
								<ol class=userlist>
									${e.map(i)}
								</ol>
							`:D`
								<div class=noresults>
									no results
								</div>
							`))}
					</div>
				`:D`
					<p>you are not permitted to administrate user roles</p>
				`}

			</div>
		`}};function ys({models:e,modals:t}){const{administrativeModel:i}=e;return{XiomeManageUsers:es(i.onStateChange)(qo({modals:t,administrativeModel:i})(bs))}}function ws(e){return((e,t)=>Ke(t,(t=>Oo(e)(t))))(jo,{XioId:Bo,XioOp:Qo,XioAvatar:Ko,XioButton:nn,XioExample:an,XioCheckbox:un,XioTextInput:yn,XioProfileCard:_n,...ts(e),...us(e),...ys(e)})}function xs(e){return async({title:t,input:i,body:o=null,yes:n={label:"okay",vibe:"positive"},no:s={label:"nevermind",vibe:"neutral"},focusNthElement:r=1,blanketClickMeansCancel:a=!0})=>new Promise((l=>{const c=document.createElement("xio-text-input");function d(){return c.value,0!==c.problems.length}function p(e){return{yes:()=>{const t=d()?void 0:{value:c.value};d()||(e.close(),l(t))},no:()=>{e.close(),l(void 0)}}}c.textarea=i.textarea??!1,c.parser=i.parser,c.validator=i.validator,c.textContent=i.label;const{controls:u,modal:h}=e({focusNthElement:r,onBlanketClick:a?e=>{e.close(),l(void 0)}:()=>{},renderContent:e=>{const i=p(e);return D`
					<div data-confirm>
						${"string"==typeof t?D`<h2>${t}</h2>`:t}
						${"string"==typeof o?D`<p>${o}</p>`:o}
						${c}
						<div data-buttons>
							<xio-button
								data-button=yes
								data-vibe=${n.vibe}
								?disabled=${d()}
								@press=${i.yes}>
									${n.label}
							</xio-button>
							<xio-button
								data-button=no
								data-vibe=${s.vibe}
								@press=${i.no}>
									${s.label}
							</xio-button>
						</div>
					</div>
				`}}),m=p(u);c.onvaluechange=()=>u.rerender(),c.onenterpress=()=>m.yes(),h.addEventListener("keyup",(({key:e})=>{"Escape"===e&&m.no()}))}))}function ks(e){return async({title:t,body:i=null,yes:o={label:"yes",vibe:"positive"},no:n={label:"no",vibe:"neutral"},focusNthElement:s=1,blanketClickMeansNo:r=!0})=>new Promise((a=>{e({focusNthElement:s,onBlanketClick:r?e=>{e.close(),a(!1)}:()=>{},renderContent:e=>D`
					<div data-confirm>
						${"string"==typeof t?D`<h2>${t}</h2>`:t}
						${"string"==typeof i?D`<p>${i}</p>`:i}
						<div data-buttons>
							<xio-button
								data-button=yes
								data-vibe="${o.vibe}"
								@press=${()=>{e.close(),a(!0)}}>
									${o.label}
							</xio-button>
							<xio-button
								data-button=no
								data-vibe="${n.vibe}"
								@press=${()=>{e.close(),a(!1)}}>
									${n.label}
							</xio-button>
						</div>
					</div>
				`})}))}vs([K()],bs.prototype,"userResults",void 0),vs([K({type:String})],bs.prototype,"searchText",void 0),bs=vs([Oo(hs)],bs);var Ss,Is=re`

*:focus {
	outline: var(--focus-outline);
}

[data-modal-system] {
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	display: block;
}

[data-modal-system] [data-blanket] {
	z-index: 101;
	position: fixed;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	display: block;
	background: #0008;
	backdrop-filter: blur(10px);
}

[data-modal-system] [data-plate] {
	z-index: 102;
	position: absolute;
	top: 0;
	left: 0;
	right: 0;

	width: 96%;
	max-width: 32em;
	min-height: 1em;
	margin: 2em auto;

	background: linear-gradient(to bottom right, #fff, #ccc);
	color: #444;
}

[data-modal-system] [data-content]:focus {
	outline: unset;
}

[data-modal-system] [data-confirm] {
	padding: 1em;
}

[data-modal-system] [data-buttons] {
	margin-top: 1em;
	text-align: right;
}

[data-modal-system] [data-button] {
	--xio-button-hover-color: white;
	--xio-button-hover-background: #666;
}

[data-modal-system] [data-vibe=positive] {
	color: green;
	--xio-button-hover-color: white;
	--xio-button-hover-background: green;
}

[data-modal-system] [data-vibe=negative] {
	color: #a00;
	--xio-button-hover-color: white;
	--xio-button-hover-background: #a00;
}

`;function $s(){let e=0;const t=new Map,{rerender:i,element:o}=function(e){const t=document.createElement("style");N(Is,t);const i=document.createElement("div");return i.setAttribute("data-modal-system",""),{element:i,rerender:function(){N(D`
			${t}
			${e().map((e=>e.render()))}
		`,i)}}}((()=>Array.from(t.values())));function n({focusNthElement:n,renderContent:s,onBlanketClick:r}){const a=e++,l={rerender:i,close:()=>{t.delete(a),i()}},c=window.pageYOffset??document.documentElement.scrollTop??document.body.scrollTop??0,d=()=>r(l);t.set(a,{render:()=>D`
					<div data-modal="${a}">
						<div data-blanket @click=${d}></div>
						<div data-plate style="top: ${c}px">
							${s(l)}
						</div>
					</div>
				`}),i();const p=o.querySelector(`[data-modal="${a}"]`);return function(e,t){const i='\n\t\t[focusable]:not([disabled])\n\t\t[tabindex]:not([disabled])\n\t\ta[href]:not([disabled])\n\t\tbutton:not([disabled])\n\t\ttextarea:not([disabled])\n\t\tinput[type="text"]:not([disabled])\n\t\tinput[type="radio"]:not([disabled])\n\t\tinput[type="checkbox"]:not([disabled])\n\t\tselect:not([disabled])\n\t'.split("\n").map((e=>e.trim())).filter((e=>e.length)).join(", "),o=Array.from(e.querySelectorAll(i));if(0===o.length)throw new Error("cannot trap focus: no focusable element");const n=o[0],s=o[o.length-1],r=o[t-1];setTimeout((()=>r.focus()),0),e.onkeydown=e=>{"Tab"===e.key&&(e.shiftKey?document.activeElement===n&&(s.focus(),e.preventDefault()):document.activeElement===s&&(n.focus(),e.preventDefault()))}}(p,n),{controls:l,modal:p}}return{modalsElement:o,modals:{popup:n,confirm:ks(n),prompt:xs(n)}}}async function Ps({appId:e,popups:t,authMediator:i,remote:o}){const n=io(window.localStorage),{modals:s,modalsElement:r}=$s(),a=await Ui({appId:e,remote:o,popups:t,storage:n,authMediator:i}),l=ws({models:a,modals:s});return await async function({link:e,authModel:t}){const{searchParams:i}=new URL(e),o=i.get("login");o?await t.login(o):await t.useExistingLogin()}({authModel:a.authModel,link:window.location.toString()}),{components:l,models:a,modals:s,modalsElement:r}}function As(e){const t={};for(const[i,o]of Object.entries(e)){t[i.split("-").map((e=>{const[t,...i]=e;return[t.toUpperCase(),...i].join("")})).join("-")]=o}return t}function Rs({fetch:e,headers:t}){return async function({link:i,args:o,meta:n,specifier:s}){const r=Ee({link:i,args:o,meta:n,headers:t,specifier:s}),a=new window.Request(i,{body:r.body,method:r.method,headers:As(r.headers)}),l=await e(a),c={};l.headers.forEach(((e,t)=>c[t]=e));return Le({headers:c,status:l.status,body:await l.text()})}}function _s({popupLink:e,namespace:t,parameters:i}){const o=new URL(e).origin;let n,s;function r(){window.removeEventListener("message",s),n.close()}const a=new Promise(((e,a)=>{s=s=>{const l=s.data;if(function({event:e,namespace:t,popupOrigin:i}){const o=!!e.data&&e.data.namespace===t,n=e.origin.toLowerCase()===i.toLowerCase();if(o){if(n)return!0;console.warn(`message denied from origin "${e.origin}"`,e)}return!1}({event:s,popupOrigin:o,namespace:t}))try{if(l.flag===Ss.ReadyResponse)n.postMessage({namespace:t,parameters:i,flag:Ss.GoRequest},o);else if(l.flag===Ss.PayloadResponse){const{payload:t}=l;r(),e(t)}else{if(l.flag!==Ss.ErrorResponse)throw r(),new Error("unknown popup message flag");{const{error:e}=l;r(),a(e)}}}catch(e){r(),a(e)}}}));return window.addEventListener("message",s),n=window.open(e,t,function(e=260,t=260){const{outerWidth:i,outerHeight:o,screenY:n,screenX:s}=window.top;return`\n\t\twidth=${e},\n\t\theight=${t},\n\t\ttop=${(o/2+n-t/2)/2},\n\t\tleft=${i/2+s-e/2},\n\t\ttoolbar=no,\n\t\tlocation=no,\n\t\tstatus=no,\n\t\tmenubar=no,\n\t\tscrollbars=yes,\n\t\tresizable=yes\n\t`}()),n.focus(),{closePopup:r,promisedPayload:a}}!function(e){e[e.ReadyResponse=0]="ReadyResponse",e[e.GoRequest=1]="GoRequest",e[e.PayloadResponse=2]="PayloadResponse",e[e.ErrorResponse=3]="ErrorResponse"}(Ss||(Ss={}));function qs({popupsBase:e}){return{triggerBankPopup:async({stripeAccountId:t,stripeAccountSetupLink:i})=>function({popupLink:e,stripeAccountId:t,stripeAccountSetupLink:i}){return _s({popupLink:e,namespace:"xiome-bank-popup",parameters:{stripeAccountId:t,stripeAccountSetupLink:i}})}({popupLink:`${e}/bank`,stripeAccountId:t,stripeAccountSetupLink:i}).promisedPayload}}async function Cs({appId:e,apiOrigin:t="https://api.xiome.io",platformOrigin:i="https://xiome.io"}){const{remote:o,authMediator:n}=function({appId:e,apiLink:t,storage:i}){const{shape:o,installAuthMediator:n}=Ye({appId:e,storage:i}),s=Te({link:t,shape:o,requester:Rs({fetch:window.fetch,headers:{}})});return{remote:s,authMediator:n({greenService:s.auth.greenService})}}({appId:e,apiLink:`${t}/`,storage:io(window.localStorage)});ot(n);return{appId:e,remote:o,authMediator:n,popups:qs({popupsBase:`${i}/popups`})}}async function Ms(e){const t={origins:[window.location.origin],storage:io(window.localStorage),platformHome:window.location.href,appWindowLink:window.location.href,latency:{min:200,max:800}};return"platform"===e.mock?await async function({platformHome:e,storage:t}){const i=await xo(qe({platformHome:e,platformOrigins:[new URL(e).origin]})),o=i.platformAppId,{remote:n,authMediator:s}=await nt({appId:o,apiLink:"https://api.xiome.io/",backend:i,storage:t,appWindowLink:e,latency:{min:200,max:800}});return{appId:o,remote:n,authMediator:s,backend:i,popups:Ae({mockStripeOperations:i.mockStripeOperations})}}(t):await So(t)}!async function(){const e=await async function(e){const t=e.mock,i=t?await Ms(e):await Cs(e),o=await Ps(i);return t&&$e({connection:i,frontend:o}),{...i,...o}}(function(){const e=document.querySelector("xiome-config");if(!e)throw new Error("<xiome-config> is required");const t=t=>e.getAttribute(t)??void 0,i={mock:t("mock"),appId:t("app"),apiOrigin:t("api"),platformOrigin:t("platform")},o=void 0===i.mock?void 0:"platform"===i.mock?"platform":"app";return o?{mock:o}:{appId:i.appId,apiOrigin:i.apiOrigin,platformOrigin:i.platformOrigin}}());document.body.prepend(e.modalsElement),Io(e.components),window.xiome=e,/^((stage\.|)xiome\.io|localhost)$/.test(window.location.hostname)&&await async function(){const e=await So({appWindowLink:window.location.href,origins:[window.location.origin],storage:zi(),latency:!1}),t=await Ps(e);$e({connection:e,frontend:t});const i={...e,...t};document.body.prepend(i.modalsElement),await i.models.authModel.sendLoginLink("creative@xiome.io");const o={};for(const[e,t]of Object.entries(i.components))o[`Demo${e}`]=t;Io(o)}()}()}();